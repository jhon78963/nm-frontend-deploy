import{c as y}from"./chunk-AH4J4TUG.js";import{A as Y,k as q,l as H,n as J,o as K,s as P,t as Q,u as U,y as X}from"./chunk-CWERYKP4.js";import"./chunk-CHCFORR6.js";import"./chunk-PIGFPF4R.js";import"./chunk-EKVFOZAU.js";import{e as W}from"./chunk-WGZSWDGW.js";import{d as O}from"./chunk-UUMPVQ5Y.js";import{d as R,e as V}from"./chunk-NNPW6EYQ.js";import"./chunk-HRPPAEPN.js";import"./chunk-LXN6L7PP.js";import{g as v,k as b}from"./chunk-WYZ7SSM5.js";import{g as x,h as B,j as z}from"./chunk-A2T6BYCT.js";import{Aa as w,Ab as S,C as d,D as u,La as k,Sa as A,Ta as g,Tb as I,Va as j,W as h,X as l,d as M,db as _,eb as D,g as L,ia as f,l as G,q as c,s as p,ta as n,ua as r,va as F,w as E,x as m,yb as N,z as $}from"./chunk-JVTAFNDW.js";var Z=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=d({type:i,selectors:[["app-form"]],standalone:!0,features:[g],decls:2,vars:0,template:function(t,o){t&1&&(n(0,"p"),k(1,"form works!"),r())}})}}return i})();var ee=(()=>{class i{constructor(e){this.apiService=e,this.sales=[],this.sales$=new L(this.sales),this.total=0,this.total$=new L(this.total)}callGetList(e=10,t=1,o=""){let a=`sales?limit=${e}&page=${t}`;return o&&(a+=`&search=${o}`),this.apiService.get(a).pipe(c(600),G(s=>{this.updateSales(s.data),this.updateTotalSales(s.paginate.total)}))}getList(){return this.sales$.asObservable()}getTotal(){return this.total$.asObservable()}create(e){return this.apiService.post("sales",e).pipe(p(()=>this.callGetList()))}delete(e){return this.apiService.delete(`sales/${e}`).pipe(p(()=>this.callGetList()))}edit(e,t){return this.apiService.patch(`sales/${e}`,t).pipe(p(()=>this.callGetList()))}getOne(e){return this.apiService.get(`sales/${e}`)}updateSales(e){this.sales=e,this.sales$.next(this.sales)}updateTotalSales(e){this.total=e,this.total$.next(this.total)}static{this.\u0275fac=function(t){return new(t||i)($(O))}}static{this.\u0275prov=E({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var se=()=>[],re=()=>[10,20,50],te=(()=>{class i{constructor(e,t,o,a,s){this.dialogService=e,this.messageService=t,this.confirmationService=o,this.loadingService=a,this.salesService=s,this.columns=[],this.limit=10,this.page=1,this.search="",this.callToAction=[{type:"button",size:"small",icon:"pi pi-pencil",outlined:!0,pTooltip:"Editar",tooltipPosition:"bottom",click:T=>this.buttonEditSale(T.id)},{type:"button",size:"small",icon:"pi pi-trash",outlined:!0,pTooltip:"Eliminar",tooltipPosition:"bottom",click:(T,oe)=>this.buttonDeleteSale(T.id,oe)}],this.formGroup=new B({search:new z(null)})}ngOnInit(){this.columns=[{header:"C\xF3digo",field:"code",clickable:!1,image:!1,money:!1},{header:"Fecha",field:"date",clickable:!1,image:!1,money:!1},{header:"Cliente",field:"customer",clickable:!1,image:!1,money:!1},{header:"Total",field:"total",clickable:!1,image:!1,money:!1},{header:"Estado",field:"status",clickable:!1,image:!1,money:!1},{header:"Acci\xF3n",field:"button",clickable:!1,image:!1,money:!1}],this.getSales(this.limit,this.page,this.search),this.formGroup.get("search")?.valueChanges.pipe(c(600)).subscribe(e=>{this.search=e||"",this.loadingService.sendLoadingState(!0),this.getSales(this.limit,this.page,this.search)})}ngOnDestroy(){this.saleModal&&this.saleModal.close()}clearFilter(){this.search="",this.loadingService.sendLoadingState(!0),this.formGroup.get("search")?.setValue("")}getSales(){return M(this,arguments,function*(e=this.limit,t=this.page,o=this.search){this.updatePage(t),this.salesService.callGetList(e,t,o).subscribe(),setTimeout(()=>{this.loadingService.sendLoadingState(!1)},600)})}onPageSelected(e){return M(this,null,function*(){this.updatePage((e.page??0)+1),this.getSales(e.rows,this.page)})}get sales(){return this.salesService.getList()}get total(){return this.salesService.getTotal()}buttonEditSale(e){this.saleModal=this.dialogService.open(Z,{data:{id:e},header:"Detalle venta",styleClass:"dialog-custom-form"}),this.saleModal.onClose.subscribe({next:t=>{t&&t?.success?P(this.messageService,"Detalle actualizado."):t?.error&&Q(this.messageService,t?.error)}})}buttonDeleteSale(e,t){this.confirmationService.confirm({target:t.target,message:"Deseas cancelar esta venta?",header:"Eliminar usuario",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger p-button-text",rejectButtonStyleClass:"p-button-text p-button-text",acceptIcon:"none",rejectIcon:"none",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.salesService.delete(e).subscribe(()=>{P(this.messageService,"La venta ha sido cancelada")})},reject:()=>{U(this.messageService,"No se realiz\xF3 ninguna acci\xF3n.")}})}updatePage(e){this.page=e}static{this.\u0275fac=function(t){return new(t||i)(l(y),l(b),l(v),l(J),l(ee))}}static{this.\u0275cmp=d({type:i,selectors:[["app-list"]],standalone:!0,features:[A([v,b,y]),g],decls:10,vars:15,consts:[[1,"card"],[1,"flex","justify-content-between","align-items-center","mt-3","gap-3"],["controlName","search",1,"w-full","md:w-3",3,"clearFilter","formGroup"],[3,"outlined"],[1,"pi","pi-plus",2,"font-size","1rem"],[3,"paginateSelected","data","columns","callToAction","cellToAction","total","limit","rowsPerPageOptions"]],template:function(t,o){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"app-input-search",2),w("clearFilter",function(){return o.clearFilter()}),r(),n(3,"p-button",3),F(4,"i",4),r()(),n(5,"app-table-pagination",5),_(6,"async"),_(7,"async"),w("paginateSelected",function(s){return o.onPageSelected(s)}),r(),F(8,"p-toast")(9,"p-confirmDialog"),r()),t&2){let a,s;h(2),f("formGroup",o.formGroup),h(),f("outlined",!0),h(2),f("data",(a=D(6,9,o.sales))!==null&&a!==void 0?a:j(13,se))("columns",o.columns)("callToAction",o.callToAction)("cellToAction",o.cellToAction)("total",(s=D(7,11,o.total))!==null&&s!==void 0?s:0)("limit",o.limit)("rowsPerPageOptions",j(14,re))}},dependencies:[S,N,Y,W,x,K,X,V,R,H,q]})}}return i})();var le=[{path:"",component:te},{path:"",pathMatch:"full",redirectTo:"sales"}],ie=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=u({type:i})}static{this.\u0275inj=m({imports:[I.forChild(le),I]})}}return i})();var Oe=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=u({type:i})}static{this.\u0275inj=m({imports:[S,ie]})}}return i})();export{Oe as SalesListModule};
