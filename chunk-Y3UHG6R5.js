import{a as X,b as Y,c as y}from"./chunk-ODTFD3QQ.js";import"./chunk-TVFTUAXU.js";import{a as ae,e as pe,f as ue,h as de,i as he,m as T,n as B,o as fe,s as ge,u as Ce}from"./chunk-VKDMURAN.js";import"./chunk-Y5QMDDSO.js";import"./chunk-ZRB5JYID.js";import"./chunk-XQ5SMVZC.js";import{b as le}from"./chunk-R4EC5V5S.js";import"./chunk-DECUXDPT.js";import"./chunk-FTJNOPBC.js";import{d as Q}from"./chunk-NELNUKEX.js";import{d as me,e as ce}from"./chunk-53BCAK53.js";import{d as se,e as ne}from"./chunk-KZGPV3OV.js";import"./chunk-6MWK2YGG.js";import"./chunk-MROZGMZP.js";import"./chunk-S23T3VNK.js";import"./chunk-ZSZR532A.js";import{d as _,g as D,h as Z,j as ee,l as te,o as M,v as ie,w as oe,x as re}from"./chunk-3IAGLYRS.js";import{g as S,k as b}from"./chunk-56NTXRTG.js";import{m as P}from"./chunk-DIBFAAWP.js";import{Ab as u,Bb as x,C as h,M as f,Ra as p,Rc as J,S as O,Sa as s,Sb as H,T as g,Uc as K,Vb as N,X as R,ba as C,ca as v,d as G,dc as E,ec as A,gb as q,ib as l,j as L,la as V,ma as z,ob as U,r as k,tb as m,ub as a,vb as c,zb as W}from"./chunk-UISEBZIM.js";var w=class{constructor(d){this.id=d.id,this.dni=d.dni,this.name=d.name,this.surname=d.surname}};var I=(()=>{class i{constructor(e){this.apiService=e,this.customers=[],this.customers$=new L(this.customers),this.total=0,this.total$=new L(this.total)}callGetList(e=10,t=1,o=""){let r=`customers?limit=${e}&page=${t}`;return o&&(r+=`&search=${o}`),this.apiService.get(r).pipe(h(600),k(n=>{this.updateCustomers(n.data),this.updateTotalCustomers(n.paginate.total)}))}getList(){return this.customers$.asObservable()}getTotal(){return this.total$.asObservable()}create(e){return this.apiService.post("customers",e).pipe(f(()=>this.callGetList()))}delete(e){return this.apiService.delete(`customers/${e}`).pipe(f(()=>this.callGetList()))}edit(e,t){return this.apiService.patch(`customers/${e}`,t).pipe(f(()=>this.callGetList()))}getOne(e){return this.apiService.get(`customers/${e}`)}updateCustomers(e){this.customers=e,this.customers$.next(this.customers)}updateTotalCustomers(e){this.total=e,this.total$.next(this.total)}static{this.\u0275fac=function(t){return new(t||i)(R(Q))}}static{this.\u0275prov=O({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Te(i,d){if(i&1){let e=W();m(0,"form",1),u("ngSubmit",function(){V(e);let o=x();return z(o.buttonSaveUser())}),m(1,"div",2)(2,"div",3),c(3,"app-input-text",4),a(),m(4,"div",3),c(5,"app-input-text",5),a(),m(6,"div",3),c(7,"app-input-text",6),a(),c(8,"button",7),a()()}if(i&2){let e=x();l("formGroup",e.form),p(8),l("disabled",!e.isValid)}}var $=(()=>{class i{constructor(e,t,o,r){this.formBuilder=e,this.customersService=t,this.dynamicDialogRef=o,this.dynamicDialogConfig=r,this.form=this.formBuilder.group({dni:["",_.required],name:["",_.required],surname:["",_.required]})}ngOnInit(){if(this.customersService.callGetList().subscribe(),this.dynamicDialogConfig.data.id){let e=this.dynamicDialogConfig.data.id;this.customersService.getOne(e).subscribe(t=>{this.form.patchValue(t)})}}get isValid(){return this.form.valid}buttonSaveUser(){let e=new w(this.form.value);if(this.dynamicDialogConfig.data.id){let t=this.dynamicDialogConfig.data.id;this.customersService.edit(t,e).subscribe({next:()=>this.dynamicDialogRef.close({success:!0}),error:()=>{}})}else this.customersService.create(e).subscribe({next:()=>{this.dynamicDialogRef.close({success:!0}),this.form.reset()},error:()=>{}})}static{this.\u0275fac=function(t){return new(t||i)(s(ie),s(I),s(Y),s(X))}}static{this.\u0275cmp=C({type:i,selectors:[["app-customers-form"]],decls:1,vars:1,consts:[[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"col-12"],["placeholder","Ingrese DNI","label","dni","controlName","dni"],["placeholder","Ingrese nombres","label","Nombre","controlName","name"],["placeholder","Ingrese apellidos","label","Apellidos","controlName","surname"],["type","submit","pButton","","label","Guardar",3,"disabled"]],template:function(t,o){t&1&&q(0,Te,9,2,"form",0),t&2&&U(0,o.form?0:-1)},dependencies:[me,te,D,ae,M]})}}return i})();var we=()=>[],Fe=()=>[10,20,50],Se=(()=>{class i{constructor(e,t,o,r,n){this.dialogService=e,this.messageService=t,this.confirmationService=o,this.loadingService=r,this.customersService=n,this.columns=[],this.limit=10,this.page=1,this.name="",this.callToAction=[{type:"button",size:"small",icon:"pi pi-pencil",outlined:!0,pTooltip:"Editar",tooltipPosition:"bottom",click:j=>this.buttonEditCustomer(j.id)},{type:"button",size:"small",icon:"pi pi-trash",outlined:!0,pTooltip:"Eliminar",tooltipPosition:"bottom",click:(j,ye)=>this.buttonDeleteCustomer(j.id,ye)}],this.formGroup=new Z({search:new ee(null)})}ngOnInit(){this.columns=[{header:"DNI",field:"dni",clickable:!1,image:!1,money:!1},{header:"Nombres",field:"name",clickable:!1,image:!1,money:!1},{header:"Apellidos",field:"surname",clickable:!1,image:!1,money:!1},{header:"Acci\xF3n",field:"button",clickable:!1,image:!1,money:!1}],this.getCustomers(this.limit,this.page,this.name),this.formGroup.get("search")?.valueChanges.pipe(h(600)).subscribe(e=>{this.name=e||"",this.loadingService.sendLoadingState(!0),this.getCustomers(this.limit,this.page,this.name)})}ngOnDestroy(){this.customerModal&&this.customerModal.close()}clearFilter(){this.name="",this.loadingService.sendLoadingState(!0),this.formGroup.get("search")?.setValue("")}getCustomers(){return G(this,arguments,function*(e=this.limit,t=this.page,o=this.name){this.updatePage(t),this.customersService.callGetList(e,t,o).subscribe(),setTimeout(()=>{this.loadingService.sendLoadingState(!1)},600)})}onPageSelected(e){return G(this,null,function*(){this.updatePage((e.page??0)+1),this.getCustomers(e.rows,this.page)})}get customers(){return this.customersService.getList()}get total(){return this.customersService.getTotal()}buttonAddCustomer(){this.customerModal=this.dialogService.open($,{data:{},header:"Crear cliente",styleClass:"dialog-custom-form"}),this.customerModal.onClose.subscribe({next:e=>{e&&e?.success?T(this.messageService,"Cliente Creado."):e?.error&&B(this.messageService,e?.error)}})}buttonEditCustomer(e){this.customerModal=this.dialogService.open($,{data:{id:e},header:"Editar cliente",styleClass:"dialog-custom-form"}),this.customerModal.onClose.subscribe({next:t=>{t&&t?.success?T(this.messageService,"Cliente actualizado."):t?.error&&B(this.messageService,t?.error)}})}buttonDeleteCustomer(e,t){this.confirmationService.confirm({target:t.target,message:"Deseas eliminar este cliente?",header:"Eliminar cliente",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger p-button-text",rejectButtonStyleClass:"p-button-text p-button-text",acceptIcon:"none",rejectIcon:"none",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.customersService.delete(e).subscribe(()=>{T(this.messageService,"El cliente ha sido eliminado")})},reject:()=>{fe(this.messageService,"No se realiz\xF3 ninguna acci\xF3n.")}})}updatePage(e){this.page=e}static{this.\u0275fac=function(t){return new(t||i)(s(y),s(b),s(S),s(de),s(I))}}static{this.\u0275cmp=C({type:i,selectors:[["app-customer-list"]],features:[H([S,b])],decls:10,vars:15,consts:[[1,"card"],[1,"flex","justify-content-between","align-items-center","mt-3","gap-3"],["controlName","search",1,"w-full","md:w-3",3,"clearFilter","formGroup"],[3,"click","outlined"],[1,"pi","pi-plus",2,"font-size","1rem"],[3,"paginateSelected","data","columns","callToAction","cellToAction","total","limit","rowsPerPageOptions"]],template:function(t,o){if(t&1&&(m(0,"div",0)(1,"div",1)(2,"app-input-search",2),u("clearFilter",function(){return o.clearFilter()}),a(),m(3,"p-button",3),u("click",function(){return o.buttonAddCustomer()}),c(4,"i",4),a()(),m(5,"app-table-pagination",5),E(6,"async"),E(7,"async"),u("paginateSelected",function(n){return o.onPageSelected(n)}),a(),c(8,"p-toast")(9,"p-confirmDialog"),a()),t&2){let r,n;p(2),l("formGroup",o.formGroup),p(),l("outlined",!0),p(2),l("data",(r=A(6,9,o.customers))!==null&&r!==void 0?r:N(13,we))("columns",o.columns)("callToAction",o.callToAction)("cellToAction",o.cellToAction)("total",(n=A(7,11,o.total))!==null&&n!==void 0?n:0)("limit",o.limit)("rowsPerPageOptions",N(14,Fe))}},dependencies:[ce,D,he,ge,M,se,pe,J],styles:[".dialog-custom-form{width:30%!important;height:auto!important}  .dialog-custom-assign{width:15%!important;height:auto!important}@media (max-width: 480px){  .dialog-custom-form{width:70%!important;height:auto!important}  .dialog-custom-assign{width:70%!important;height:auto!important}}"]})}}return i})();var Ie=[{path:"",component:Se},{path:"",pathMatch:"full",redirectTo:"users"}],be=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=v({type:i})}static{this.\u0275inj=g({imports:[P.forChild(Ie),P]})}}return i})();var pt=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=v({type:i})}static{this.\u0275inj=g({providers:[y],imports:[K,be,Ce,oe,re,ne,ue,le]})}}return i})();export{pt as CustomersModule};
