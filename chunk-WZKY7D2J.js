import{a as be}from"./chunk-5E2NO5LY.js";import{a as X,b as Y,c as x}from"./chunk-ODTFD3QQ.js";import"./chunk-TVFTUAXU.js";import{B as Se,a as ae,b as le,l as ue,m as de,o as he,p as fe,t as L,u as k,v as ge,z as ve}from"./chunk-QGEUABJK.js";import"./chunk-R5IEJ2W2.js";import"./chunk-OHBNF7H4.js";import{j as pe}from"./chunk-BLSNVWGO.js";import"./chunk-7HYQIZLR.js";import{d as me,e as ce}from"./chunk-53BCAK53.js";import{d as Q}from"./chunk-NELNUKEX.js";import{d as se,e as ne}from"./chunk-KZGPV3OV.js";import"./chunk-MROZGMZP.js";import"./chunk-6MWK2YGG.js";import"./chunk-S23T3VNK.js";import"./chunk-ZSZR532A.js";import{g as M,k as w}from"./chunk-56NTXRTG.js";import{d,g as D,h as Z,j as ee,l as te,o as j,v as ie,w as re,x as oe}from"./chunk-3IAGLYRS.js";import{m as B}from"./chunk-DIBFAAWP.js";import{Ab as h,Bb as T,C as S,M as b,Ra as p,Rc as F,S as O,Sa as n,Sb as J,T as C,Uc as K,Vb as f,X as q,ba as y,ca as _,d as V,dc as g,ec as v,gb as U,ib as u,j as P,la as z,ma as W,ob as I,r as R,tb as a,ub as l,vb as c,zb as H}from"./chunk-UISEBZIM.js";var E=class{constructor(m){this.id=m.id,this.username=m.username,this.email=m.email,this.name=m.name,this.surname=m.surname,this.profilePicture=m.profilePicture,this.googleId=m.googleId,this.roleId=m.roleId}};var A=(()=>{class i{constructor(e){this.apiService=e,this.users=[],this.users$=new P(this.users),this.total=0,this.total$=new P(this.total)}callGetList(e=10,t=1,r=""){let o=`users?limit=${e}&page=${t}`;return r&&(o+=`&search=${r}`),this.apiService.get(o).pipe(S(600),R(s=>{this.updateUsers(s.data),this.updateTotalUsers(s.paginate.total)}))}getList(){return this.users$.asObservable()}getTotal(){return this.total$.asObservable()}create(e){return this.apiService.post("users",e).pipe(b(()=>this.callGetList()))}delete(e){return this.apiService.delete(`users/${e}`).pipe(b(()=>this.callGetList()))}edit(e,t){return this.apiService.patch(`users/${e}`,t).pipe(b(()=>this.callGetList()))}getOne(e){return this.apiService.get(`users/${e}`)}updateUsers(e){this.users=e,this.users$.next(this.users)}updateTotalUsers(e){this.total=e,this.total$.next(this.total)}static{this.\u0275fac=function(t){return new(t||i)(q(Q))}}static{this.\u0275prov=O({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var we=()=>[];function xe(i,m){if(i&1&&(a(0,"div",3),c(1,"app-input-select",7),g(2,"async"),l()),i&2){let e,t=T(2);p(),u("options",(e=v(2,1,t.roles))!==null&&e!==void 0?e:f(3,we))}}function De(i,m){i&1&&(a(0,"div",3),c(1,"app-input-text",8),l(),a(2,"div",3),c(3,"app-input-text",9),l())}function je(i,m){if(i&1){let e=H();a(0,"form",1),h("ngSubmit",function(){z(e);let r=T();return W(r.buttonSaveUser())}),a(1,"div",2),U(2,xe,3,4,"div",3),a(3,"div",3),c(4,"app-input-text",4),l(),a(5,"div",3),c(6,"app-input-text",5),l(),U(7,De,4,0),c(8,"button",6),l()()}if(i&2){let e=T();u("formGroup",e.form),p(2),I(2,e.userId===0?2:-1),p(5),I(7,e.userId===0?7:-1),p(),u("disabled",!e.isValid)}}var $=(()=>{class i{constructor(e,t,r,o,s){this.formBuilder=e,this.usersService=t,this.rolesService=r,this.dynamicDialogRef=o,this.dynamicDialogConfig=s,this.userId=0,this.form=this.formBuilder.group({username:["",d.required],email:["",[d.required,d.email]],name:["",d.required],surname:["",d.required],roleId:[1,d.required]})}ngOnInit(){if(this.rolesService.callGetList().subscribe(),this.dynamicDialogConfig.data.id){let e=this.dynamicDialogConfig.data.id;this.userId=e,this.removeValidatorsForEdit(),this.usersService.getOne(e).subscribe(t=>{this.form.patchValue(t)})}}removeValidatorsForEdit(){this.form.get("username")?.clearValidators(),this.form.get("username")?.updateValueAndValidity(),this.form.get("email")?.clearValidators(),this.form.get("email")?.updateValueAndValidity()}get roles(){return this.rolesService.getList()}get isValid(){return this.form.valid}buttonSaveUser(){if(this.form.valid){let e=new E(this.form.value);this.userId?this.usersService.edit(this.userId,e).subscribe({next:()=>this.dynamicDialogRef.close({success:!0}),error:()=>{}}):this.usersService.create(e).subscribe({next:()=>{this.dynamicDialogRef.close({success:!0}),this.form.reset()},error:()=>{}})}else this.form.markAllAsTouched()}static{this.\u0275fac=function(t){return new(t||i)(n(ie),n(A),n(be),n(Y),n(X))}}static{this.\u0275cmp=y({type:i,selectors:[["app-users-form"]],decls:1,vars:1,consts:[[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"col-12"],["placeholder","Ingrese nombres","label","Nombre","controlName","name"],["placeholder","Ingrese apellidos","label","Apellidos","controlName","surname"],["type","submit","pButton","","label","Guardar",3,"disabled"],["placeholder","Seleccione role","label","Rol","controlName","roleId","for","role","id","role","optionLabel","name","optionValue","id",3,"options"],["placeholder","Ingrese username","label","Username","controlName","username"],["placeholder","Ingrese email","label","Email","controlName","email"]],template:function(t,r){t&1&&U(0,je,9,4,"form",0),t&2&&I(0,r.form?0:-1)},dependencies:[me,te,D,le,ae,j,F]})}}return i})();var Le=()=>[],Ee=()=>[10,20,50],ye=(()=>{class i{constructor(e,t,r,o,s){this.dialogService=e,this.messageService=t,this.confirmationService=r,this.loadingService=o,this.usersService=s,this.columns=[],this.limit=10,this.page=1,this.name="",this.callToAction=[{type:"button",size:"small",icon:"pi pi-pencil",outlined:!0,pTooltip:"Editar",tooltipPosition:"bottom",click:N=>this.buttonEditUSer(N.id)},{type:"button",size:"small",icon:"pi pi-trash",outlined:!0,pTooltip:"Eliminar",tooltipPosition:"bottom",click:(N,Ue)=>this.buttonDeleteUser(N.id,Ue)}],this.formGroup=new Z({search:new ee(null)})}ngOnInit(){this.columns=[{header:"Username",field:"username",clickable:!1,image:!1,money:!1},{header:"Email",field:"email",clickable:!1,image:!1,money:!1},{header:"Nombres",field:"name",clickable:!1,image:!1,money:!1},{header:"Apellidos",field:"surname",clickable:!1,image:!1,money:!1},{header:"Acci\xF3n",field:"button",clickable:!1,image:!1,money:!1}],this.getUsers(this.limit,this.page,this.name),this.formGroup.get("search")?.valueChanges.pipe(S(600)).subscribe(e=>{this.name=e||"",this.loadingService.sendLoadingState(!0),this.getUsers(this.limit,this.page,this.name)})}ngOnDestroy(){this.userModal&&this.userModal.close()}clearFilter(){this.name="",this.loadingService.sendLoadingState(!0),this.formGroup.get("search")?.setValue("")}getUsers(){return V(this,arguments,function*(e=this.limit,t=this.page,r=this.name){this.updatePage(t),this.usersService.callGetList(e,t,r).subscribe(),setTimeout(()=>{this.loadingService.sendLoadingState(!1)},600)})}onPageSelected(e){return V(this,null,function*(){this.updatePage((e.page??0)+1),this.getUsers(e.rows,this.page)})}get users(){return this.usersService.getList()}get total(){return this.usersService.getTotal()}buttonAddUser(){this.userModal=this.dialogService.open($,{data:{},header:"Crear usuario",styleClass:"dialog-custom-form"}),this.userModal.onClose.subscribe({next:e=>{e&&e?.success?L(this.messageService,"Usuario Creado."):e?.error&&k(this.messageService,e?.error)}})}buttonEditUSer(e){this.userModal=this.dialogService.open($,{data:{id:e},header:"Editar usuario",styleClass:"dialog-custom-form"}),this.userModal.onClose.subscribe({next:t=>{t&&t?.success?L(this.messageService,"Usuario actualizado."):t?.error&&k(this.messageService,t?.error)}})}buttonDeleteUser(e,t){this.confirmationService.confirm({target:t.target,message:"Deseas eliminar este usuario?",header:"Eliminar usuario",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger p-button-text",rejectButtonStyleClass:"p-button-text p-button-text",acceptIcon:"none",rejectIcon:"none",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.usersService.delete(e).subscribe(()=>{L(this.messageService,"El usuario ha sido eliminado")})},reject:()=>{ge(this.messageService,"No se realiz\xF3 ninguna acci\xF3n.")}})}updatePage(e){this.page=e}static{this.\u0275fac=function(t){return new(t||i)(n(x),n(w),n(M),n(he),n(A))}}static{this.\u0275cmp=y({type:i,selectors:[["app-user-list"]],features:[J([M,w])],decls:10,vars:15,consts:[[1,"card"],[1,"flex","justify-content-between","align-items-center","mt-3","gap-3"],["controlName","search",1,"w-full","md:w-3",3,"clearFilter","formGroup"],[3,"click","outlined"],[1,"pi","pi-plus",2,"font-size","1rem"],[3,"paginateSelected","data","columns","callToAction","cellToAction","total","limit","rowsPerPageOptions"]],template:function(t,r){if(t&1&&(a(0,"div",0)(1,"div",1)(2,"app-input-search",2),h("clearFilter",function(){return r.clearFilter()}),l(),a(3,"p-button",3),h("click",function(){return r.buttonAddUser()}),c(4,"i",4),l()(),a(5,"app-table-pagination",5),g(6,"async"),g(7,"async"),h("paginateSelected",function(s){return r.onPageSelected(s)}),l(),c(8,"p-toast")(9,"p-confirmDialog"),l()),t&2){let o,s;p(2),u("formGroup",r.formGroup),p(),u("outlined",!0),p(2),u("data",(o=v(6,9,r.users))!==null&&o!==void 0?o:f(13,Le))("columns",r.columns)("callToAction",r.callToAction)("cellToAction",r.cellToAction)("total",(s=v(7,11,r.total))!==null&&s!==void 0?s:0)("limit",r.limit)("rowsPerPageOptions",f(14,Ee))}},dependencies:[ce,D,fe,ve,j,se,ue,F],styles:[".dialog-custom-form{width:30%!important;height:auto!important}  .dialog-custom-assign{width:15%!important;height:auto!important}@media (max-width: 480px){  .dialog-custom-form{width:70%!important;height:auto!important}  .dialog-custom-assign{width:70%!important;height:auto!important}}"]})}}return i})();var Ge=[{path:"",component:ye},{path:"",pathMatch:"full",redirectTo:"users"}],_e=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=_({type:i})}static{this.\u0275inj=C({imports:[B.forChild(Ge),B]})}}return i})();var St=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=_({type:i})}static{this.\u0275inj=C({providers:[x],imports:[K,_e,Se,re,oe,ne,de,pe]})}}return i})();export{St as UsersModule};
