import{a as re,b as ne,c as v}from"./chunk-FTM6AZP4.js";import{B as L,j as be,l as xe,m as ye,o as Ce,p as _e,t as U,u as De,v as Te,z as Me}from"./chunk-OTKL6CSN.js";import"./chunk-PKPWRCW7.js";import"./chunk-7QZVAUUM.js";import"./chunk-IKHQUVIJ.js";import{d as Se,e as ve}from"./chunk-UXKUMFFU.js";import{d as ae}from"./chunk-SU5FXICQ.js";import{d as he,e as ge}from"./chunk-JLFYD4SE.js";import"./chunk-3JYME56N.js";import"./chunk-CPF55P7Y.js";import{g as I,k as S}from"./chunk-KJUOHDYT.js";import{d as se,g as P,h as le,j as me,l as ce,o as pe,t as de,u as ue,v as fe}from"./chunk-CR7W443G.js";import{Aa as x,Ab as g,B as T,C as M,H as K,I as Q,Ka as l,Ma as d,Na as Z,Ra as F,Sa as w,Tb as q,Ua as R,V as s,W as p,Xa as ee,cb as f,d as B,db as z,eb as y,fa as V,g as N,ha as u,l as W,na as k,q as C,qa as H,r as _,ra as O,rb as te,sa as o,ta as a,ua as h,v as Y,w as D,xb as ie,y as J,ya as X,yb as E,za as b,zb as oe}from"./chunk-DIPV63T5.js";var j=class{constructor(n){this.id=n.id,this.code=n.code,this.creationTime=n.creationTime,this.total=n.total,this.status=n.status,this.paymentMethod=n.paymentMethod,this.customer=n.customer}};function Fe(t,n){return n.transform(t,"yyyy-MM-dd HH:mm:ss")}var $=(()=>{class t{constructor(e){this.apiService=e,this.sales=[],this.sales$=new N(this.sales),this.total=0,this.total$=new N(this.total)}callGetList(e=10,i=1,r=""){let m=`sales?limit=${e}&page=${i}`;return r&&(m+=`&search=${r}`),this.apiService.get(m).pipe(C(600),W(c=>{this.updateSales(c.data),this.updateTotalSales(c.paginate.total)}))}getList(){return this.sales$.asObservable()}getTotal(){return this.total$.asObservable()}create(e){return this.apiService.post("sales",e).pipe(_(()=>this.callGetList()))}delete(e){return this.apiService.delete(`sales/${e}`).pipe(_(()=>this.callGetList()))}edit(e,i){return this.apiService.patch(`sales/${e}`,i).pipe(_(()=>this.callGetList()))}getOne(e){return this.apiService.get(`sales/${e}`)}updateSales(e){this.sales=e,this.sales$.next(this.sales)}updateTotalSales(e){this.total=e,this.total$.next(this.total)}static{this.\u0275fac=function(i){return new(i||t)(J(ae))}}static{this.\u0275prov=Y({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Ee=(t,n)=>n.id,Ne=(t,n,e)=>({"pi-money-bill text-green-600":t,"pi-mobile text-purple-600":n,"pi-credit-card text-orange-600":e});function Ve(t,n){if(t&1&&(o(0,"div",9),h(1,"i",21),o(2,"span",22),l(3),a(),o(4,"span",23),l(5),f(6,"number"),a()()),t&2){let e=n.$implicit;s(),u("ngClass",ee(6,Ne,e.method==="CASH",e.method==="YAPE"||e.method==="PLIN",e.method==="CARD")),s(2),d("",e.method,":"),s(2),d("S/ ",y(6,3,e.amount,"1.2-2"),"")}}function ke(t,n){if(t&1&&(o(0,"div",10),l(1),a()),t&2){let e=x(3);s(),d(" Pago \xFAnico: ",e.saleDetails.paymentMethod," ")}}function He(t,n){if(t&1&&(o(0,"tr",17)(1,"td",24),l(2),a(),o(3,"td",25)(4,"div",26),l(5),a(),o(6,"div",27),l(7),a()(),o(8,"td",28),l(9),f(10,"number"),a(),o(11,"td",29),l(12),f(13,"number"),a()()),t&2){let e=n.$implicit;s(2),d(" ",e.quantity," "),s(3),d(" ",e.product_name," "),s(2),Z(" ",e.size," \u2022 ",e.color," "),s(2),d(" S/ ",y(10,6,e.unit_price,"1.2-2")," "),s(3),d(" S/ ",y(13,9,e.subtotal,"1.2-2")," ")}}function Oe(t,n){if(t&1&&(o(0,"div",6)(1,"span",7),l(2,"M\xE9todos de Pago"),a(),o(3,"div",8),H(4,Ve,7,10,"div",9,Ee,!1,ke,2,1,"div",10),a()(),o(7,"div",11)(8,"span",7),l(9,"Productos Vendidos"),a(),o(10,"div",12)(11,"table",13)(12,"thead",14)(13,"tr")(14,"th",15),l(15,"Cant."),a(),o(16,"th",15),l(17,"Descripci\xF3n"),a(),o(18,"th",16),l(19,"P. Unit"),a(),o(20,"th",16),l(21,"Total"),a()()(),o(22,"tbody"),H(23,He,14,12,"tr",17,Ee),a(),o(25,"tfoot",18)(26,"tr")(27,"td",19),l(28," Total Venta "),a(),o(29,"td",20),l(30),f(31,"number"),a()()()()()()),t&2){let e=x(2);s(4),O(e.saleDetails.payments),s(19),O(e.saleDetails.items),s(7),d(" S/ ",y(31,2,e.saleDetails.total,"1.2-2")," ")}}function Re(t,n){if(t&1){let e=X();o(0,"form",1),b("ngSubmit",function(){K(e);let r=x();return Q(r.buttonSaveSale())}),o(1,"div",2)(2,"div",3),h(3,"app-input-date",4),a(),V(4,Oe,32,5),h(5,"button",5),a()()}if(t&2){let e=x();u("formGroup",e.form),s(4),k(4,e.saleDetails?4:-1),s(),u("disabled",!e.isValid)}}var Ie=(()=>{class t{constructor(e,i,r,m,c){this.formBuilder=e,this.salesService=i,this.dynamicDialogRef=r,this.dynamicDialogConfig=m,this.datePipe=c,this.form=this.formBuilder.group({creationTime:[new Date,se.required]}),this.saleDetails=null}ngOnInit(){if(this.dynamicDialogConfig.data.id){let e=this.dynamicDialogConfig.data.id;this.salesService.getOne(e).subscribe(i=>{this.saleDetails=i,i.datetime_iso?this.form.patchValue({creationTime:new Date(i.datetime_iso)}):this.form.patchValue(i)})}}get isValid(){return this.form.valid}buttonSaveSale(){if(this.form){let e=new j(this.form.value);if(e.creationTime){let r=Fe(this.form.get("creationTime")?.value,this.datePipe);r&&(e.creationTime=r)}let i=this.dynamicDialogConfig.data.id;this.salesService.edit(i,e).subscribe({next:()=>this.dynamicDialogRef.close(!0),error:()=>{}})}}static{this.\u0275fac=function(i){return new(i||t)(p(de),p($),p(ne),p(re),p(E))}}static{this.\u0275cmp=T({type:t,selectors:[["app-form"]],standalone:!0,features:[F([v,S,E]),w],decls:1,vars:1,consts:[[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"col-12","mb-3"],["label","Fecha de Venta","for","creationTime","type","text","id","creationTime","placeholder","Ingresa la fecha","controlName","creationTime"],["type","submit","pButton","","label","Guardar Cambios",1,"mt-4","w-full","p-button-primary","font-bold",3,"disabled"],[1,"col-12","mb-2"],[1,"block","text-500","font-bold","mb-2","text-sm","uppercase"],[1,"flex","flex-wrap","gap-2"],[1,"border-1","border-round-lg","p-2","px-3","surface-card","flex","align-items-center","gap-2","shadow-1"],[1,"text-gray-500","text-sm","font-italic"],[1,"col-12","mt-2"],[1,"border-1","border-200","border-round-xl","overflow-hidden"],[1,"w-full","text-sm",2,"border-collapse","collapse"],[1,"surface-100","text-600","border-bottom-1","border-200"],[1,"p-2","text-left","font-bold"],[1,"p-2","text-right","font-bold"],[1,"border-bottom-1","surface-border","hover:surface-50","transition-colors"],[1,"surface-50"],["colspan","3",1,"p-2","text-right","font-bold","text-600","uppercase","text-xs"],[1,"p-2","text-right","font-black","text-lg","text-indigo-700","pr-3"],[1,"pi","text-lg",3,"ngClass"],[1,"font-bold","text-700","text-sm"],[1,"text-900","font-bold"],[1,"p-2","pl-3","font-bold","text-900"],[1,"p-2"],[1,"font-bold","text-800"],[1,"text-xs","text-500"],[1,"p-2","text-right","text-700"],[1,"p-2","text-right","font-bold","text-900","pr-3"]],template:function(i,r){i&1&&V(0,Re,6,3,"form",0),i&2&&k(0,r.form?0:-1)},dependencies:[g,te,oe,ue,ce,P,fe,pe,L,Se,be]})}}return t})();var ze=()=>[],qe=()=>[10,20,50],Pe=(()=>{class t{constructor(e,i,r,m,c){this.dialogService=e,this.messageService=i,this.confirmationService=r,this.loadingService=m,this.salesService=c,this.columns=[],this.limit=10,this.page=1,this.search="",this.callToAction=[{type:"button",size:"small",icon:"pi pi-pencil",outlined:!0,pTooltip:"Editar",tooltipPosition:"bottom",click:A=>this.buttonEditSale(A.id)},{type:"button",size:"small",icon:"pi pi-trash",outlined:!0,pTooltip:"Eliminar",tooltipPosition:"bottom",click:(A,je)=>this.buttonDeleteSale(A.id,je)}],this.formGroup=new le({search:new me(null)})}ngOnInit(){this.columns=[{header:"C\xF3digo",field:"code",clickable:!1,image:!1,money:!1},{header:"Fecha",field:"date",clickable:!1,image:!1,money:!1},{header:"Cliente",field:"customer",clickable:!1,image:!1,money:!1},{header:"Total",field:"total",clickable:!1,image:!1,money:!1},{header:"Estado",field:"status",clickable:!1,image:!1,money:!1},{header:"Acci\xF3n",field:"button",clickable:!1,image:!1,money:!1}],this.getSales(this.limit,this.page,this.search),this.formGroup.get("search")?.valueChanges.pipe(C(600)).subscribe(e=>{this.search=e||"",this.loadingService.sendLoadingState(!0),this.getSales(this.limit,this.page,this.search)})}ngOnDestroy(){this.saleModal&&this.saleModal.close()}clearFilter(){this.search="",this.loadingService.sendLoadingState(!0),this.formGroup.get("search")?.setValue("")}getSales(){return B(this,arguments,function*(e=this.limit,i=this.page,r=this.search){this.updatePage(i),this.salesService.callGetList(e,i,r).subscribe(),setTimeout(()=>{this.loadingService.sendLoadingState(!1)},600)})}onPageSelected(e){return B(this,null,function*(){this.updatePage((e.page??0)+1),this.getSales(e.rows,this.page)})}get sales(){return this.salesService.getList()}get total(){return this.salesService.getTotal()}buttonEditSale(e){this.saleModal=this.dialogService.open(Ie,{data:{id:e},header:"Detalle venta",styleClass:"dialog-custom-form"}),this.saleModal.onClose.subscribe({next:i=>{i&&i?.success?U(this.messageService,"Detalle actualizado."):i?.error&&De(this.messageService,i?.error)}})}buttonDeleteSale(e,i){this.confirmationService.confirm({target:i.target,message:"Deseas cancelar esta venta?",header:"Eliminar usuario",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger p-button-text",rejectButtonStyleClass:"p-button-text p-button-text",acceptIcon:"none",rejectIcon:"none",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.salesService.delete(e).subscribe(()=>{U(this.messageService,"La venta ha sido cancelada")})},reject:()=>{Te(this.messageService,"No se realiz\xF3 ninguna acci\xF3n.")}})}updatePage(e){this.page=e}static{this.\u0275fac=function(i){return new(i||t)(p(v),p(S),p(I),p(Ce),p($))}}static{this.\u0275cmp=T({type:t,selectors:[["app-list"]],standalone:!0,features:[F([I,S,v]),w],decls:10,vars:15,consts:[[1,"card"],[1,"flex","justify-content-between","align-items-center","mt-3","gap-3"],["controlName","search",1,"w-full","md:w-3",3,"clearFilter","formGroup"],[3,"outlined"],[1,"pi","pi-plus",2,"font-size","1rem"],[3,"paginateSelected","data","columns","callToAction","cellToAction","total","limit","rowsPerPageOptions"]],template:function(i,r){if(i&1&&(o(0,"div",0)(1,"div",1)(2,"app-input-search",2),b("clearFilter",function(){return r.clearFilter()}),a(),o(3,"p-button",3),h(4,"i",4),a()(),o(5,"app-table-pagination",5),f(6,"async"),f(7,"async"),b("paginateSelected",function(c){return r.onPageSelected(c)}),a(),h(8,"p-toast")(9,"p-confirmDialog"),a()),i&2){let m,c;s(2),u("formGroup",r.formGroup),s(),u("outlined",!0),s(2),u("data",(m=z(6,9,r.sales))!==null&&m!==void 0?m:R(13,ze))("columns",r.columns)("callToAction",r.callToAction)("cellToAction",r.cellToAction)("total",(c=z(7,11,r.total))!==null&&c!==void 0?c:0)("limit",r.limit)("rowsPerPageOptions",R(14,qe))}},dependencies:[g,ie,L,ve,P,_e,Me,ge,he,ye,xe],styles:[".dialog-custom-form{width:30%!important;height:35rem!important}  .dialog-custom-assign{width:15%!important;height:35rem!important}@media (max-width: 480px){  .dialog-custom-form{width:70%!important;height:35rem!important}  .dialog-custom-assign{width:70%!important;height:35rem!important}}"]})}}return t})();var Ue=[{path:"",component:Pe},{path:"",pathMatch:"full",redirectTo:"sales"}],Le=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=M({type:t})}static{this.\u0275inj=D({imports:[q.forChild(Ue),q]})}}return t})();var Et=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=M({type:t})}static{this.\u0275inj=D({imports:[g,Le]})}}return t})();export{Et as SalesListModule};
