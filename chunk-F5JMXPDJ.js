import{a as Qe}from"./chunk-TCB5M5KB.js";import{a as U,b as J,c as D}from"./chunk-ODTFD3QQ.js";import"./chunk-TVFTUAXU.js";import{B as ae,j as He,l as We,m as qe,o as Ke,p as Ye,t as oe,u as de,v as Ue,z as Je}from"./chunk-GXGAIHHQ.js";import{a as Oe,b as ze}from"./chunk-ZRB5JYID.js";import"./chunk-XQ5SMVZC.js";import{g as ie,h as Ge}from"./chunk-6DNDLIQE.js";import{a as te,b as Le}from"./chunk-FTJNOPBC.js";import{d as we}from"./chunk-NELNUKEX.js";import{d as ne,e as Re,f as $e}from"./chunk-53BCAK53.js";import{d as Be,e as je}from"./chunk-KZGPV3OV.js";import"./chunk-MROZGMZP.js";import"./chunk-6MWK2YGG.js";import"./chunk-S23T3VNK.js";import"./chunk-ZSZR532A.js";import{b as Q,d as P,f as X,g as Z,h as Ee,j as Te,k as Pe,l as Me,m as Fe,o as Ie,p as De,q as ke,r as Ve,v as Ne,w as ee,x as Ae}from"./chunk-3IAGLYRS.js";import{g as Y,k as I}from"./chunk-56NTXRTG.js";import{m as me}from"./chunk-DIBFAAWP.js";import{Ab as x,Bb as m,C as j,Lb as s,Lc as Se,M as N,Mb as w,Nb as u,Nc as Ce,Ob as le,Oc as ye,Pb as O,Qb as z,Ra as l,Rb as H,Rc as ve,S as he,Sa as b,Sb as W,Sc as q,T as L,Tb as F,Tc as K,Uc as E,Vb as se,X as xe,Y as A,a as pe,b as ue,ba as M,ca as G,d as V,dc as _,ec as ce,fc as S,gb as C,ib as d,j as re,la as f,ma as h,ob as y,qb as ge,r as fe,rb as R,sb as $,tb as o,ub as a,vb as g,wb as _e,xb as be,zb as v}from"./chunk-UISEBZIM.js";function Xe(i,c){return c.transform(i,"yyyy-MM-dd HH:mm:ss")}var k=(()=>{class i{constructor(e){this.apiService=e,this.sales=[],this.sales$=new re(this.sales),this.total=0,this.total$=new re(this.total)}callGetList(e=10,t=1,n=""){let r=`sales?limit=${e}&page=${t}`;return n&&(r+=`&search=${n}`),this.apiService.get(r).pipe(j(600),fe(p=>{this.updateSales(p.data),this.updateTotalSales(p.paginate.total)}))}getList(){return this.sales$.asObservable()}getTotal(){return this.total$.asObservable()}create(e){return this.apiService.post("sales",e).pipe(N(()=>this.callGetList()))}delete(e){return this.apiService.delete(`sales/${e}`).pipe(N(()=>this.callGetList()))}edit(e,t){return this.apiService.patch(`sales/${e}`,t).pipe(N(()=>this.callGetList()))}getOne(e){return this.apiService.get(`sales/${e}`)}searchByCode(e){return this.apiService.get(`sales?page=1&limit=1&search=${e}`)}processExchange(e){return this.apiService.post("sales/exchange",e).pipe(N(()=>this.callGetList()))}updateSales(e){this.sales=e,this.sales$.next(this.sales)}updateTotalSales(e){this.total=e,this.total$.next(this.total)}static{this.\u0275fac=function(t){return new(t||i)(xe(we))}}static{this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function dt(i,c){if(i&1&&(_e(0),o(1,"tr",27)(2,"td",28),s(3),a(),o(4,"td",29)(5,"div",30),s(6),a()(),o(7,"td",29),g(8,"input",31),a(),o(9,"td",32),s(10),_(11,"number"),a()(),be()),i&2){let e,t,n,r=c.$implicit,p=c.index;l(),d("formGroupName",p),l(2),u(" ",(e=r.get("quantity"))==null?null:e.value," "),l(3),u(" ",(t=r.get("description_full"))==null?null:t.value," "),l(4),u(" ",S(11,4,(n=r.get("subtotal"))==null?null:n.value,"1.2-2")," ")}}function pt(i,c){if(i&1){let e=v();o(0,"div",33),g(1,"p-dropdown",34),o(2,"div",35)(3,"span",36),s(4,"S/"),a(),g(5,"input",37),a(),o(6,"button",38),x("click",function(){let n=f(e).index,r=m(2);return h(r.removePayment(n))}),a()()}if(i&2){let e=c.index,t=m(2);d("formGroupName",e),l(),d("options",t.paymentMethodsList),l(5),d("disabled",t.paymentsControls.length===1)}}function ut(i,c){if(i&1&&(o(0,"span",39),s(1),_(2,"number"),a()),i&2){let e=m(2);l(),u(" Falta: S/ ",S(2,1,e.calculatedTotal-e.calculatedPayments,"1.2-2")," ")}}function ft(i,c){if(i&1&&(o(0,"span",39),s(1),_(2,"number"),a()),i&2){let e=m(2);l(),u(" Sobran: S/ ",S(2,1,e.calculatedPayments-e.calculatedTotal,"1.2-2")," ")}}function ht(i,c){i&1&&(o(0,"span",40),g(1,"i",41),s(2," Correcto "),a())}function xt(i,c){if(i&1){let e=v();o(0,"form",1),x("ngSubmit",function(){f(e);let n=m();return h(n.buttonSaveSale())}),o(1,"div",2)(2,"div",3),g(3,"app-input-date",4),a(),o(4,"div",3)(5,"span",5),s(6,"Productos"),a(),o(7,"div",6)(8,"table",7)(9,"thead",8)(10,"tr")(11,"th",9),s(12,"Cant."),a(),o(13,"th",9),s(14,"Desc."),a(),o(15,"th",10),s(16,"Precio"),a(),o(17,"th",11),s(18,"Sub."),a()()(),o(19,"tbody"),C(20,dt,12,7,"ng-container",12),a(),o(21,"tfoot",13)(22,"tr")(23,"td",14),s(24," Total Venta "),a(),o(25,"td",15),s(26),_(27,"number"),a()()()()()(),o(28,"div",16)(29,"div",17)(30,"span",18),s(31,"Pagos"),a(),o(32,"button",19),x("click",function(){f(e);let n=m();return h(n.addPaymentRow())}),a()(),o(33,"div",20),C(34,pt,7,3,"div",21),a(),o(35,"div",22)(36,"span",23),s(37),_(38,"number"),a(),C(39,ut,3,4,"span",24)(40,ft,3,4,"span",24)(41,ht,3,0,"span",25),a()(),g(42,"button",26),a()()}if(i&2){let e=m();d("formGroup",e.form),l(20),d("ngForOf",e.itemsControls),l(6),u(" ",S(27,10,e.calculatedTotal,"1.2-2")," "),l(8),d("ngForOf",e.paymentsControls),l(),d("ngClass",e.calculatedTotal-e.calculatedPayments>.1?"bg-red-50 text-red-600":"bg-green-50 text-green-700"),l(2),u("Total Pagado: S/ ",S(38,13,e.calculatedPayments,"1.2-2"),""),l(2),d("ngIf",e.calculatedTotal-e.calculatedPayments>.1),l(),d("ngIf",e.calculatedTotal-e.calculatedPayments<-.1),l(),d("ngIf",e.calculatedTotal-e.calculatedPayments<=.1&&e.calculatedTotal-e.calculatedPayments>=-.1),l(),d("disabled",!e.isFormValid)}}var nt=(()=>{class i{constructor(e,t,n,r,p){this.formBuilder=e,this.salesService=t,this.dynamicDialogRef=n,this.dynamicDialogConfig=r,this.datePipe=p,this.form=this.formBuilder.group({creationTime:[new Date,P.nullValidator],items:this.formBuilder.array([]),payments:this.formBuilder.array([])}),this.calculatedTotal=0,this.calculatedPayments=0,this.paymentMethodsList=["CASH","YAPE","CARD"]}ngOnInit(){if(this.dynamicDialogConfig.data.id){let e=this.dynamicDialogConfig.data.id;this.salesService.getOne(e).subscribe(t=>{t.datetime_iso&&this.form.patchValue({creationTime:new Date(t.datetime_iso)}),this.initItems(t.items),this.initPayments(t.payments),this.recalculateTotals()})}}initItems(e){let t=this.form.get("items");t.clear(),e.forEach(n=>{let r=this.formBuilder.group({id:[n.id],product_name:[n.product_name],description_full:[n.description_full],quantity:[n.quantity],unit_price:[n.unit_price,[P.required,P.min(0)]],subtotal:[n.subtotal]});r.get("unit_price")?.valueChanges.subscribe(()=>{let p=r.get("quantity")?.value,T=r.get("unit_price")?.value;r.patchValue({subtotal:p*T},{emitEvent:!1}),this.recalculateTotals()}),t.push(r)})}initPayments(e){if(this.form.get("payments").clear(),!e||e.length===0){this.addPaymentRow(this.calculatedTotal,"CASH");return}e.forEach(n=>{this.addPaymentRow(n.amount,n.method)})}addPaymentRow(e=0,t="CASH"){let n=this.form.get("payments"),r=this.formBuilder.group({method:[t,P.required],amount:[e,[P.required,P.min(0)]]});r.get("amount")?.valueChanges.subscribe(()=>this.recalculateTotals()),n.push(r),this.recalculateTotals()}removePayment(e){this.form.get("payments").removeAt(e),this.recalculateTotals()}recalculateTotals(){let e=this.form.get("items").controls;this.calculatedTotal=e.reduce((n,r)=>n+(r.get("subtotal")?.value||0),0);let t=this.form.get("payments").controls;this.calculatedPayments=t.reduce((n,r)=>n+(r.get("amount")?.value||0),0)}get itemsControls(){return this.form.get("items").controls}get paymentsControls(){return this.form.get("payments").controls}get isFormValid(){let e=Math.abs(this.calculatedTotal-this.calculatedPayments);return this.form.valid&&e<.1}buttonSaveSale(){if(this.isFormValid){let e=this.form.getRawValue(),t=this.dynamicDialogConfig.data.id,n={id:t,code:this.dynamicDialogConfig.data.code,total:this.calculatedTotal,status:this.dynamicDialogConfig.data.status,creationTime:Xe(e.creationTime,this.datePipe),items:e.items.map(r=>({id:r.id,unit_price:r.unit_price})),payments:e.payments.map(r=>({method:r.method,amount:r.amount}))};this.salesService.edit(t,n).subscribe({next:()=>this.dynamicDialogRef.close(!0),error:()=>{}})}}static{this.\u0275fac=function(t){return new(t||i)(b(Ne),b(k),b(J),b(U),b(q))}}static{this.\u0275cmp=M({type:i,selectors:[["app-form"]],standalone:!0,features:[W([D,I,q]),F],decls:1,vars:1,consts:[[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"col-12"],["label","Fecha","for","creationTime","controlName","creationTime"],[1,"block","text-500","font-bold","mb-2","text-sm","uppercase"],["formArrayName","items",1,"border-1","border-200","border-round-xl","overflow-hidden"],[1,"w-full","text-sm"],[1,"surface-100","border-bottom-1","border-200"],[1,"p-2","text-left"],[1,"p-2","text-right","w-6rem"],[1,"p-2","text-right"],[4,"ngFor","ngForOf"],[1,"surface-50"],["colspan","3",1,"p-2","text-right","font-bold"],[1,"p-2","text-right","font-black","text-indigo-700"],[1,"col-12","mb-3"],[1,"flex","justify-content-between","align-items-center","mb-2"],[1,"text-500","font-bold","text-sm","uppercase"],["type","button","pButton","","icon","pi pi-plus","label","Agregar Pago",1,"p-button-text","p-button-sm","py-1",3,"click"],["formArrayName","payments",1,"flex","flex-column","gap-2"],["class","flex gap-2 align-items-center",3,"formGroupName",4,"ngFor","ngForOf"],[1,"flex","justify-content-between","mt-2","p-2","border-round",3,"ngClass"],[1,"text-xs","font-bold","uppercase"],["class","text-xs font-bold",4,"ngIf"],["class","text-xs font-bold flex align-items-center gap-1",4,"ngIf"],["type","submit","pButton","","label","Guardar Todo","autofocus","",1,"mt-4","w-full","p-button-primary","font-bold","shadow-2",3,"disabled"],[1,"border-bottom-1","surface-border",3,"formGroupName"],[1,"p-2","text-center","font-bold"],[1,"p-2"],[1,"font-bold","text-xs"],["type","number","pInputText","","formControlName","unit_price",1,"w-full","text-right","p-1","h-2rem","text-sm"],[1,"p-2","text-right","font-bold"],[1,"flex","gap-2","align-items-center",3,"formGroupName"],["formControlName","method","styleClass","w-full text-sm",1,"w-full",3,"options"],[1,"p-inputgroup","w-8rem"],[1,"p-inputgroup-addon","py-1","px-2","text-xs"],["type","number","pInputText","","formControlName","amount",1,"text-right","p-1","text-sm","font-bold"],["type","button","pButton","","icon","pi pi-trash",1,"p-button-danger","p-button-text","p-button-rounded",3,"click","disabled"],[1,"text-xs","font-bold"],[1,"text-xs","font-bold","flex","align-items-center","gap-1"],[1,"pi","pi-check-circle"]],template:function(t,n){t&1&&C(0,xt,43,16,"form",0),t&2&&y(0,n.form?0:-1)},dependencies:[E,Se,Ce,ye,K,ee,Me,Q,Fe,X,Z,Ae,Ie,Ve,De,ke,ae,te,ie,ne,He]})}}return i})();var gt=(i,c)=>c.id,_t=(i,c)=>c.color_id;function bt(i,c){i&1&&(o(0,"div",1),g(1,"i",2),a())}function St(i,c){if(i&1){let e=v();o(0,"div",13),x("click",function(){let n=f(e).$implicit,r=m(3);return h(r.selectReturnItem(n))}),o(1,"div")(2,"span",14),s(3),a(),o(4,"span",15),s(5),a()(),o(6,"span",16),s(7),_(8,"number"),a()()}if(i&2){let e=c.$implicit;l(3),w(e.product_name),l(2),le("",e.size," \u2022 ",e.color,""),l(2),u("S/ ",S(8,4,e.unit_price,"1.2-2"),"")}}function Ct(i,c){if(i&1&&(o(0,"div",3)(1,"div",5)(2,"div",6)(3,"span",7),s(4),a(),o(5,"span",8),s(6),a()(),o(7,"p",9),s(8),a()(),o(9,"span",10),s(10,"Selecciona el producto a devolver:"),a(),o(11,"div",11),R(12,St,9,7,"div",12,gt),a()()),i&2){let e=m(2);l(4),w(e.saleFound.code),l(2),w(e.saleFound.date),l(2),u(" Cliente: ",e.saleFound.customer==null?null:e.saleFound.customer.name," "),l(4),$(e.saleFound.items)}}function yt(i,c){if(i&1){let e=v();o(0,"div",30),x("click",function(){let n=f(e).$implicit,r=m().$implicit,p=m(4);return h(p.selectNewVariant(n,r))}),o(1,"span",31),s(2),a(),o(3,"span",15),s(4),a(),o(5,"span",32),s(6),a()()}if(i&2){let e=c.$implicit,t=m().$implicit;l(2),w(t),l(2),w(e.colorName),l(2),u("S/ ",e.price,"")}}function vt(i,c){if(i&1&&R(0,yt,7,3,"div",29,_t),i&2){let e=c.$implicit,t=m(4);$(t.newProductFound.variants[e])}}function wt(i,c){if(i&1&&(o(0,"div",24)(1,"p",27),s(2),a(),o(3,"div",28),R(4,vt,2,0,null,null,ge),a()()),i&2){let e=m(3);l(2),u(" ",e.newProductFound.name," "),l(2),$(e.objectKeys(e.newProductFound.variants))}}function Et(i,c){if(i&1){let e=v();o(0,"div",4)(1,"div",17)(2,"span",18),s(3,"Devuelve:"),a(),o(4,"span",19),s(5),a()(),o(6,"span",20),s(7,"Buscar Nuevo Producto"),a(),o(8,"div",21)(9,"input",22),H("ngModelChange",function(n){f(e);let r=m(2);return z(r.newProductSearch,n)||(r.newProductSearch=n),h(n)}),x("keydown.enter",function(){f(e);let n=m(2);return h(n.searchNewProduct())}),a(),o(10,"button",23),x("click",function(){f(e);let n=m(2);return h(n.searchNewProduct())}),a()(),C(11,wt,6,1,"div",24),o(12,"div",25)(13,"button",26),x("click",function(){f(e);let n=m(2);return h(n.step=1)}),a()()()}if(i&2){let e=m(2);l(5),le("",e.selectedReturnItem.product_name," (S/ ",e.returnAmount,")"),l(4),O("ngModel",e.newProductSearch),l(2),y(11,e.newProductFound?11:-1)}}function Tt(i,c){if(i&1){let e=v();o(0,"div",48)(1,"span",49),s(2,"Diferencia a Pagar"),a(),o(3,"span",50),s(4),_(5,"number"),a()(),o(6,"div",51)(7,"span",52),s(8,"M\xE9todo de Pago"),a(),o(9,"p-dropdown",53),H("ngModelChange",function(n){f(e);let r=m(3);return z(r.paymentMethod,n)||(r.paymentMethod=n),h(n)}),a()()}if(i&2){let e=m(3);l(4),u("S/ ",S(5,3,e.difference,"1.2-2"),""),l(5),d("options",e.paymentMethods),O("ngModel",e.paymentMethod)}}function Pt(i,c){if(i&1&&(o(0,"div",54),g(1,"i",55),o(2,"div",56)(3,"span",57),s(4),_(5,"number"),a(),o(6,"span",58),s(7,"No se devuelve dinero en efectivo."),a()()()),i&2){let e=m(3);l(4),u("Saldo a favor: S/ ",S(5,1,e.difference*-1,"1.2-2"),"")}}function Mt(i,c){i&1&&(o(0,"div",54),g(1,"i",59),o(2,"span",60),s(3,"Cambio directo (Sin cobro)"),a()())}function Ft(i,c){if(i&1){let e=v();o(0,"div",0)(1,"h3",33),s(2,"Confirmar Cambio"),a(),o(3,"div",34)(4,"div",35)(5,"span",36),s(6,"Devuelve"),a(),o(7,"span",37),s(8),_(9,"number"),a(),o(10,"span",38),s(11),a()(),o(12,"div",39)(13,"span",40),s(14,"Lleva (Editar)"),a(),o(15,"div",41)(16,"p-inputNumber",42),H("ngModelChange",function(n){f(e);let r=m(2);return z(r.selectedNewVariant.negotiatedPrice,n)||(r.selectedNewVariant.negotiatedPrice=n),h(n)}),a()(),o(17,"span",43),s(18),a()()(),o(19,"div",44),C(20,Tt,10,6)(21,Pt,8,4)(22,Mt,4,0),a(),o(23,"div",45)(24,"button",46),x("click",function(){f(e);let n=m(2);return h(n.confirmExchange())}),a(),o(25,"button",47),x("click",function(){f(e);let n=m(2);return h(n.step=2)}),a()()()}if(i&2){let e=m(2);l(8),u("S/ ",S(9,5,e.returnAmount,"1.2-2"),""),l(3),w(e.selectedReturnItem.product_name),l(5),O("ngModel",e.selectedNewVariant.negotiatedPrice),l(2),w(e.newProductFound.name),l(2),y(20,e.difference>0?20:e.difference<0?21:22)}}function It(i,c){if(i&1&&C(0,Ct,14,3,"div",3)(1,Et,14,4,"div",4)(2,Ft,26,8,"div",0),i&2){let e=m();y(0,e.step===1&&e.saleFound?0:-1),l(),y(1,e.step===2?1:-1),l(),y(2,e.step===3?2:-1)}}var ot=(()=>{class i{constructor(){this.salesService=A(k),this.posService=A(Qe),this.config=A(U),this.ref=A(J),this.step=1,this.loading=!0,this.saleFound=null,this.selectedReturnItem=null,this.newProductSearch="",this.newProductFound=null,this.selectedNewVariant=null,this.paymentMethod="CASH",this.paymentMethods=[{label:"Efectivo",value:"CASH"},{label:"Yape/Plin",value:"YAPE"},{label:"Tarjeta",value:"CARD"}]}ngOnInit(){let e=this.config.data?.id;e?this.loadSale(e):this.loading=!1}loadSale(e){this.loading=!0,this.salesService.getOne(e).subscribe({next:t=>{this.saleFound=t,this.loading=!1,this.step=1},error:()=>{this.loading=!1,this.ref.close()}})}selectReturnItem(e){this.selectedReturnItem=e,this.step=2}searchNewProduct(){return V(this,null,function*(){if(!this.newProductSearch)return;let e=yield this.posService.searchProductBySku(this.newProductSearch);e&&(this.newProductFound=e)})}selectNewVariant(e,t){this.selectedNewVariant=ue(pe({},e),{size:t,negotiatedPrice:e.price}),this.step=3}get returnAmount(){return this.selectedReturnItem?.unit_price||0}get newAmount(){return this.selectedNewVariant?.negotiatedPrice||0}get difference(){return this.newAmount-this.returnAmount}confirmExchange(){let e=this.difference,t={returned_detail_id:this.selectedReturnItem.id,difference_amount:e>0?e:0,payment_method:this.paymentMethod,new_item:{product_size_id:this.selectedNewVariant.product_size_id,color_id:this.selectedNewVariant.color_id,final_price:this.newAmount}};this.salesService.processExchange(t).subscribe({next:()=>{this.ref.close({success:!0})},error:n=>console.error(n)})}close(){this.ref.close()}objectKeys(e){return Object.keys(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=M({type:i,selectors:[["app-exchange"]],standalone:!0,features:[F],decls:3,vars:1,consts:[[1,"flex","flex-column","h-full"],[1,"flex","align-items-center","justify-content-center","p-5"],[1,"pi","pi-spin","pi-spinner","text-3xl","text-gray-400"],[1,"flex","flex-column","gap-3"],[1,"flex","flex-column","gap-3","fadein-animation"],[1,"bg-blue-50","p-3","border-round","border-1","border-blue-100"],[1,"flex","justify-content-between"],[1,"font-bold","text-blue-800"],[1,"text-sm","text-blue-600"],[1,"text-xs","text-blue-600","m-0","mt-1"],[1,"text-sm","font-bold","text-gray-600","uppercase","mt-2"],[1,"border-1","border-gray-200","border-round","overflow-hidden"],[1,"flex","justify-content-between","align-items-center","p-3","hover:surface-100","cursor-pointer","border-bottom-1","border-gray-100","transition-colors"],[1,"flex","justify-content-between","align-items-center","p-3","hover:surface-100","cursor-pointer","border-bottom-1","border-gray-100","transition-colors",3,"click"],[1,"font-bold","block","text-gray-800","text-sm"],[1,"text-xs","text-500"],[1,"font-bold","text-indigo-600"],[1,"flex","justify-content-between","align-items-center","surface-100","p-2","border-round"],[1,"text-xs","font-bold","text-gray-500","uppercase"],[1,"font-bold","text-sm"],[1,"font-bold","text-gray-600","text-sm"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","SKU o Nombre",3,"ngModelChange","keydown.enter","ngModel"],["pButton","","icon","pi pi-search",3,"click"],[1,"mt-2","border-1","border-gray-200","border-round","p-3","surface-card"],[1,"mt-auto","pt-3"],["pButton","","label","Atr\xE1s",1,"p-button-text","p-button-sm","w-full",3,"click"],[1,"font-bold","m-0","text-sm","mb-2","text-gray-800"],[1,"flex","flex-wrap","gap-2"],[1,"cursor-pointer","border-1","border-gray-300","border-round","px-3","py-2","hover:bg-indigo-50","hover:border-indigo-500","transition-colors","flex","flex-column","align-items-center","gap-1","min-w-5rem"],[1,"cursor-pointer","border-1","border-gray-300","border-round","px-3","py-2","hover:bg-indigo-50","hover:border-indigo-500","transition-colors","flex","flex-column","align-items-center","gap-1","min-w-5rem",3,"click"],[1,"font-bold","text-xs"],[1,"text-primary","font-bold","text-sm"],[1,"text-center","text-900","mt-0"],[1,"grid","grid-nogutter","gap-3"],[1,"col","bg-red-50","p-3","border-round","border-1","border-red-100","text-center"],[1,"block","text-xs","font-bold","text-red-500","uppercase","mb-1"],[1,"block","text-xl","font-black","text-red-700"],[1,"text-xs","text-red-400","block","mt-1","line-clamp-1"],[1,"col","bg-green-50","p-3","border-round","border-1","border-green-100","text-center"],[1,"block","text-xs","font-bold","text-green-500","uppercase","mb-1"],[1,"flex","justify-content-center"],["mode","currency","currency","PEN","locale","es-PE","inputStyleClass","text-center font-black text-xl text-green-700 bg-transparent border-none w-full p-0 shadow-none focus:shadow-none",1,"w-full","block",3,"ngModelChange","ngModel"],[1,"text-xs","text-green-400","block","mt-1","line-clamp-1"],[1,"flex-1","flex","flex-column","justify-content-center","mt-3"],[1,"flex","flex-column","gap-2"],["pButton","","label","PROCESAR CAMBIO","icon","pi pi-check",1,"p-button-lg","font-bold","shadow-2","w-full","py-3",3,"click"],["pButton","","label","Cancelar",1,"p-button-text","w-full","text-500",3,"click"],[1,"surface-card","p-4","border-round-xl","shadow-2","border-1","border-yellow-200","text-center","mb-4"],[1,"block","text-yellow-600","font-bold","uppercase","text-xs","mb-1"],[1,"block","text-4xl","font-black","text-900"],[1,"field"],[1,"font-bold","text-sm","mb-2","block","text-gray-700"],["optionLabel","label","optionValue","value","styleClass","w-full",3,"ngModelChange","options","ngModel"],[1,"bg-blue-50","border-1","border-blue-200","p-3","border-round","text-blue-700","flex","align-items-center","justify-content-center","gap-2","mb-4"],[1,"pi","pi-info-circle","text-2xl"],[1,"text-left"],[1,"font-bold","block"],[1,"text-xs"],[1,"pi","pi-check-circle","text-2xl"],[1,"font-bold"]],template:function(t,n){t&1&&(o(0,"div",0),C(1,bt,2,0,"div",1)(2,It,3,3),a()),t&2&&(l(),y(1,n.loading?1:2))},dependencies:[E,K,ee,Q,X,Pe,Le,te,$e,ne,Ge,ie,ze,Oe],styles:["[_nghost-%COMP%]{display:block}"]})}}return i})();var Dt=()=>[],kt=()=>[10,20,50],at=(()=>{class i{constructor(e,t,n,r,p){this.dialogService=e,this.messageService=t,this.confirmationService=n,this.loadingService=r,this.salesService=p,this.columns=[],this.limit=10,this.page=1,this.search="",this.callToAction=[{type:"button",size:"small",icon:"pi pi-pencil",outlined:!0,pTooltip:"Cambio de producto",tooltipPosition:"bottom",click:T=>this.buttonExchangeSale(T.id)},{type:"button",size:"small",icon:"pi pi-pencil",outlined:!0,pTooltip:"Editar",tooltipPosition:"bottom",click:T=>this.buttonEditSale(T.id)},{type:"button",size:"small",icon:"pi pi-trash",outlined:!0,pTooltip:"Eliminar",tooltipPosition:"bottom",click:(T,lt)=>this.buttonDeleteSale(T.id,lt)}],this.formGroup=new Ee({search:new Te(null)})}ngOnInit(){this.columns=[{header:"C\xF3digo",field:"code",clickable:!1,image:!1,money:!1},{header:"Fecha",field:"date",clickable:!1,image:!1,money:!1},{header:"Cliente",field:"customer",clickable:!1,image:!1,money:!1},{header:"Total",field:"total",clickable:!1,image:!1,money:!1},{header:"Estado",field:"status",clickable:!1,image:!1,money:!1},{header:"Acci\xF3n",field:"button",clickable:!1,image:!1,money:!1}],this.getSales(this.limit,this.page,this.search),this.formGroup.get("search")?.valueChanges.pipe(j(600)).subscribe(e=>{this.search=e||"",this.loadingService.sendLoadingState(!0),this.getSales(this.limit,this.page,this.search)})}ngOnDestroy(){this.saleModal&&this.saleModal.close()}clearFilter(){this.search="",this.loadingService.sendLoadingState(!0),this.formGroup.get("search")?.setValue("")}getSales(){return V(this,arguments,function*(e=this.limit,t=this.page,n=this.search){this.updatePage(t),this.salesService.callGetList(e,t,n).subscribe(),setTimeout(()=>{this.loadingService.sendLoadingState(!1)},600)})}onPageSelected(e){return V(this,null,function*(){this.updatePage((e.page??0)+1),this.getSales(e.rows,this.page)})}get sales(){return this.salesService.getList()}get total(){return this.salesService.getTotal()}buttonExchangeSale(e){this.saleModal=this.dialogService.open(ot,{data:{id:e},header:"Cambio de mercader\xEDa",styleClass:"dialog-custom-form"}),this.saleModal.onClose.subscribe({next:t=>{t&&t?.success?oe(this.messageService,"Detalle actualizado."):t?.error&&de(this.messageService,t?.error)}})}buttonEditSale(e){this.saleModal=this.dialogService.open(nt,{data:{id:e},header:"Detalle venta",styleClass:"dialog-custom-form"}),this.saleModal.onClose.subscribe({next:t=>{t&&t?.success?oe(this.messageService,"Detalle actualizado."):t?.error&&de(this.messageService,t?.error)}})}buttonDeleteSale(e,t){this.confirmationService.confirm({target:t.target,message:"Deseas cancelar esta venta?",header:"Eliminar usuario",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger p-button-text",rejectButtonStyleClass:"p-button-text p-button-text",acceptIcon:"none",rejectIcon:"none",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.salesService.delete(e).subscribe(()=>{oe(this.messageService,"La venta ha sido cancelada")})},reject:()=>{Ue(this.messageService,"No se realiz\xF3 ninguna acci\xF3n.")}})}updatePage(e){this.page=e}static{this.\u0275fac=function(t){return new(t||i)(b(D),b(I),b(Y),b(Ke),b(k))}}static{this.\u0275cmp=M({type:i,selectors:[["app-list"]],standalone:!0,features:[W([Y,I,D]),F],decls:10,vars:15,consts:[[1,"card"],[1,"flex","justify-content-between","align-items-center","mt-3","gap-3"],["controlName","search",1,"w-full","md:w-3",3,"clearFilter","formGroup"],[3,"outlined"],[1,"pi","pi-plus",2,"font-size","1rem"],[3,"paginateSelected","data","columns","callToAction","cellToAction","total","limit","rowsPerPageOptions"]],template:function(t,n){if(t&1&&(o(0,"div",0)(1,"div",1)(2,"app-input-search",2),x("clearFilter",function(){return n.clearFilter()}),a(),o(3,"p-button",3),g(4,"i",4),a()(),o(5,"app-table-pagination",5),_(6,"async"),_(7,"async"),x("paginateSelected",function(p){return n.onPageSelected(p)}),a(),g(8,"p-toast")(9,"p-confirmDialog"),a()),t&2){let r,p;l(2),d("formGroup",n.formGroup),l(),d("outlined",!0),l(2),d("data",(r=ce(6,9,n.sales))!==null&&r!==void 0?r:se(13,Dt))("columns",n.columns)("callToAction",n.callToAction)("cellToAction",n.cellToAction)("total",(p=ce(7,11,n.total))!==null&&p!==void 0?p:0)("limit",n.limit)("rowsPerPageOptions",se(14,kt))}},dependencies:[E,ve,ae,Re,Z,Ye,Je,je,Be,qe,We],styles:[".dialog-custom-form{width:30%!important;height:55rem!important}  .dialog-custom-assign{width:15%!important;height:35rem!important}@media (max-width: 480px){  .dialog-custom-form{width:70%!important;height:35rem!important}  .dialog-custom-assign{width:70%!important;height:35rem!important}}"]})}}return i})();var Vt=[{path:"",component:at},{path:"",pathMatch:"full",redirectTo:"sales"}],rt=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=G({type:i})}static{this.\u0275inj=L({imports:[me.forChild(Vt),me]})}}return i})();var Fi=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=G({type:i})}static{this.\u0275inj=L({imports:[E,rt]})}}return i})();export{Fi as SalesListModule};
