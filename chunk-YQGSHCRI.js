import{a as U,b as X,c as h}from"./chunk-FTM6AZP4.js";import{B as _,j as ce,l as pe,m as de,o as ue,p as fe,t as k,u as he,v as ge,z as Se}from"./chunk-OTKL6CSN.js";import"./chunk-PKPWRCW7.js";import"./chunk-7QZVAUUM.js";import"./chunk-IKHQUVIJ.js";import{d as le,e as me}from"./chunk-UXKUMFFU.js";import{d as Q}from"./chunk-SU5FXICQ.js";import{d as se,e as ne}from"./chunk-JLFYD4SE.js";import"./chunk-3JYME56N.js";import"./chunk-CPF55P7Y.js";import{g as w,k as f}from"./chunk-KJUOHDYT.js";import{d as Y,g as F,h as Z,j as ee,l as te,o as ie,t as oe,u as ae,v as re}from"./chunk-CR7W443G.js";import{Aa as $,Ab as u,B as b,C,H as R,I as z,Ra as M,Sa as T,Tb as B,Ua as E,V as p,W as s,cb as N,d as G,db as A,fa as q,g as P,ha as m,l as O,na as W,q as S,r as v,sa as c,ta as l,ua as d,v as V,w as y,xb as K,y as H,ya as J,yb as D,za as g}from"./chunk-DIPV63T5.js";var L=class{constructor(n){this.id=n.id,this.code=n.code,this.creationTime=n.creationTime,this.total=n.total,this.status=n.status,this.paymentMethod=n.paymentMethod,this.customer=n.customer}};function ve(i,n){return n.transform(i,"yyyy-MM-dd HH:mm:ss")}var x=(()=>{class i{constructor(e){this.apiService=e,this.sales=[],this.sales$=new P(this.sales),this.total=0,this.total$=new P(this.total)}callGetList(e=10,t=1,o=""){let a=`sales?limit=${e}&page=${t}`;return o&&(a+=`&search=${o}`),this.apiService.get(a).pipe(S(600),O(r=>{this.updateSales(r.data),this.updateTotalSales(r.paginate.total)}))}getList(){return this.sales$.asObservable()}getTotal(){return this.total$.asObservable()}create(e){return this.apiService.post("sales",e).pipe(v(()=>this.callGetList()))}delete(e){return this.apiService.delete(`sales/${e}`).pipe(v(()=>this.callGetList()))}edit(e,t){return this.apiService.patch(`sales/${e}`,t).pipe(v(()=>this.callGetList()))}getOne(e){return this.apiService.get(`sales/${e}`)}updateSales(e){this.sales=e,this.sales$.next(this.sales)}updateTotalSales(e){this.total=e,this.total$.next(this.total)}static{this.\u0275fac=function(t){return new(t||i)(H(Q))}}static{this.\u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Le(i,n){if(i&1){let e=J();c(0,"form",1),g("ngSubmit",function(){R(e);let o=$();return z(o.buttonSaveSale())}),c(1,"div",2)(2,"div",3),d(3,"app-input-date",4),l(),d(4,"button",5),l()()}if(i&2){let e=$();m("formGroup",e.form),p(4),m("disabled",!e.isValid)}}var be=(()=>{class i{constructor(e,t,o,a,r){this.formBuilder=e,this.salesService=t,this.dynamicDialogRef=o,this.dynamicDialogConfig=a,this.datePipe=r,this.form=this.formBuilder.group({creationTime:[new Date,Y.required]})}ngOnInit(){if(this.dynamicDialogConfig.data.id){let e=this.dynamicDialogConfig.data.id;this.salesService.getOne(e).subscribe(t=>{this.form.patchValue(t)})}}get isValid(){return this.form.valid}buttonSaveSale(){if(this.form){let e=new L(this.form.value);if(e.creationTime){let o=ve(this.form.get("creationTime")?.value,this.datePipe);o&&(e.creationTime=o)}let t=this.dynamicDialogConfig.data.id;this.salesService.edit(t,e).subscribe({next:()=>this.dynamicDialogRef.close(),error:()=>{}})}}static{this.\u0275fac=function(t){return new(t||i)(s(oe),s(x),s(X),s(U),s(D))}}static{this.\u0275cmp=b({type:i,selectors:[["app-form"]],standalone:!0,features:[M([h,f,D]),T],decls:1,vars:1,consts:[[3,"formGroup"],[3,"ngSubmit","formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"col-12"],["label","Fecha","for","creationTime","type","text","id","creationTime","placeholder","Ingresa la fecha","controlName","creationTime"],["type","submit","pButton","","label","Guardar",1,"mt-3",3,"disabled"]],template:function(t,o){t&1&&q(0,Le,5,2,"form",0),t&2&&W(0,o.form?0:-1)},dependencies:[u,ae,te,F,re,ie,_,le,ce]})}}return i})();var je=()=>[],xe=()=>[10,20,50],Ce=(()=>{class i{constructor(e,t,o,a,r){this.dialogService=e,this.messageService=t,this.confirmationService=o,this.loadingService=a,this.salesService=r,this.columns=[],this.limit=10,this.page=1,this.search="",this.callToAction=[{type:"button",size:"small",icon:"pi pi-pencil",outlined:!0,pTooltip:"Editar",tooltipPosition:"bottom",click:I=>this.buttonEditSale(I.id)},{type:"button",size:"small",icon:"pi pi-trash",outlined:!0,pTooltip:"Eliminar",tooltipPosition:"bottom",click:(I,Te)=>this.buttonDeleteSale(I.id,Te)}],this.formGroup=new Z({search:new ee(null)})}ngOnInit(){this.columns=[{header:"C\xF3digo",field:"code",clickable:!1,image:!1,money:!1},{header:"Fecha",field:"date",clickable:!1,image:!1,money:!1},{header:"Cliente",field:"customer",clickable:!1,image:!1,money:!1},{header:"Total",field:"total",clickable:!1,image:!1,money:!1},{header:"Estado",field:"status",clickable:!1,image:!1,money:!1},{header:"Acci\xF3n",field:"button",clickable:!1,image:!1,money:!1}],this.getSales(this.limit,this.page,this.search),this.formGroup.get("search")?.valueChanges.pipe(S(600)).subscribe(e=>{this.search=e||"",this.loadingService.sendLoadingState(!0),this.getSales(this.limit,this.page,this.search)})}ngOnDestroy(){this.saleModal&&this.saleModal.close()}clearFilter(){this.search="",this.loadingService.sendLoadingState(!0),this.formGroup.get("search")?.setValue("")}getSales(){return G(this,arguments,function*(e=this.limit,t=this.page,o=this.search){this.updatePage(t),this.salesService.callGetList(e,t,o).subscribe(),setTimeout(()=>{this.loadingService.sendLoadingState(!1)},600)})}onPageSelected(e){return G(this,null,function*(){this.updatePage((e.page??0)+1),this.getSales(e.rows,this.page)})}get sales(){return this.salesService.getList()}get total(){return this.salesService.getTotal()}buttonEditSale(e){this.saleModal=this.dialogService.open(be,{data:{id:e},header:"Detalle venta",styleClass:"dialog-custom-form"}),this.saleModal.onClose.subscribe({next:t=>{t&&t?.success?k(this.messageService,"Detalle actualizado."):t?.error&&he(this.messageService,t?.error)}})}buttonDeleteSale(e,t){this.confirmationService.confirm({target:t.target,message:"Deseas cancelar esta venta?",header:"Eliminar usuario",icon:"pi pi-info-circle",acceptButtonStyleClass:"p-button-danger p-button-text",rejectButtonStyleClass:"p-button-text p-button-text",acceptIcon:"none",rejectIcon:"none",acceptLabel:"S\xED",rejectLabel:"No",accept:()=>{this.salesService.delete(e).subscribe(()=>{k(this.messageService,"La venta ha sido cancelada")})},reject:()=>{ge(this.messageService,"No se realiz\xF3 ninguna acci\xF3n.")}})}updatePage(e){this.page=e}static{this.\u0275fac=function(t){return new(t||i)(s(h),s(f),s(w),s(ue),s(x))}}static{this.\u0275cmp=b({type:i,selectors:[["app-list"]],standalone:!0,features:[M([w,f,h]),T],decls:10,vars:15,consts:[[1,"card"],[1,"flex","justify-content-between","align-items-center","mt-3","gap-3"],["controlName","search",1,"w-full","md:w-3",3,"clearFilter","formGroup"],[3,"outlined"],[1,"pi","pi-plus",2,"font-size","1rem"],[3,"paginateSelected","data","columns","callToAction","cellToAction","total","limit","rowsPerPageOptions"]],template:function(t,o){if(t&1&&(c(0,"div",0)(1,"div",1)(2,"app-input-search",2),g("clearFilter",function(){return o.clearFilter()}),l(),c(3,"p-button",3),d(4,"i",4),l()(),c(5,"app-table-pagination",5),N(6,"async"),N(7,"async"),g("paginateSelected",function(r){return o.onPageSelected(r)}),l(),d(8,"p-toast")(9,"p-confirmDialog"),l()),t&2){let a,r;p(2),m("formGroup",o.formGroup),p(),m("outlined",!0),p(2),m("data",(a=A(6,9,o.sales))!==null&&a!==void 0?a:E(13,je))("columns",o.columns)("callToAction",o.callToAction)("cellToAction",o.cellToAction)("total",(r=A(7,11,o.total))!==null&&r!==void 0?r:0)("limit",o.limit)("rowsPerPageOptions",E(14,xe))}},dependencies:[u,K,_,me,F,fe,Se,ne,se,de,pe],styles:[".dialog-custom-form{width:30%!important;height:35rem!important}  .dialog-custom-assign{width:15%!important;height:35rem!important}@media (max-width: 480px){  .dialog-custom-form{width:70%!important;height:35rem!important}  .dialog-custom-assign{width:70%!important;height:35rem!important}}"]})}}return i})();var Ie=[{path:"",component:Ce},{path:"",pathMatch:"full",redirectTo:"sales"}],Me=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=C({type:i})}static{this.\u0275inj=y({imports:[B.forChild(Ie),B]})}}return i})();var ft=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=C({type:i})}static{this.\u0275inj=y({imports:[u,Me]})}}return i})();export{ft as SalesListModule};
