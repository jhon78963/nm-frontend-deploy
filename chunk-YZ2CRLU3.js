import{d as xe}from"./chunk-SU5FXICQ.js";import{b as j,f as Q,k as $,m as te,u as q}from"./chunk-CR7W443G.js";import{Aa as p,Ab as M,B as F,C as U,Ga as de,H as f,Ha as pe,I as g,Ia as me,Ka as c,La as k,Ma as b,Na as ue,Oa as X,Pa as J,Qa as Z,Sa as A,Tb as ie,V as l,a as V,b as z,ca as w,cb as I,d as N,eb as T,f as re,fa as v,ha as O,ia as G,ja as E,k as K,la as le,lb as S,mb as fe,na as y,nb as ee,pa as ce,q as ae,qa as R,ra as B,sa as r,ta as a,ua as h,ub as ge,v as se,w as H,ya as C,z as P,za as u,zb as L}from"./chunk-DIPV63T5.js";var D=(()=>{class n{constructor(){this.apiService=P(xe),this.cart=w([]),this.currentCustomer=w(null),this.modalState=w({isOpen:!1,product:null,isEditing:!1}),this.toastMessage=w(null),this.paymentMethod=w("EFECTIVO"),this.isLoading=w(!1),this.grandTotal=S(()=>this.cart().reduce((e,t)=>e+t.total,0)),this.totalItems=S(()=>this.cart().reduce((e,t)=>e+t.quantity,0))}searchProductBySku(e){return N(this,null,function*(){this.isLoading.set(!0);try{return yield K(this.apiService.get(`pos/products?sku=${e}`))}catch(t){console.error("Error buscando producto:",t),this.showToast("Producto no encontrado");return}finally{this.isLoading.set(!1)}})}searchCustomerByDni(e){return N(this,null,function*(){this.isLoading.set(!0);try{let t=yield K(this.apiService.get(`pos/customers?dni=${e}`));return t?(this.currentCustomer.set(t),this.showToast("Cliente encontrado"),!0):!1}catch(t){return console.error("Error buscando cliente:",t),this.showToast("Cliente no encontrado / Error API"),!1}finally{this.isLoading.set(!1)}})}processCheckoutWithPayments(e){return N(this,null,function*(){if(this.cart().length===0)return this.showToast("El carrito est\xE1 vac\xEDo");this.isLoading.set(!0);let t={customer:{id:this.currentCustomer()?.id},total:this.grandTotal(),payments:e,items:this.cart().map(i=>({name:i.name,quantity:i.quantity,unitPrice:i.unitPrice,total:i.total,size:i.size,color:{product_size_id:i.color.product_size_id,color_id:i.color.color_id,colorName:i.color.colorName,hex:i.color.hex,stock:i.color.stock}}))};try{let i=yield K(this.apiService.post("pos/checkout",t));i.success&&(this.showToast(`Venta ${i.sale_id} Exitosa!`),this.printTicket(i.sale_id),this.clearCart())}catch(i){this.showToast("Error al procesar venta"),console.error(i)}finally{this.isLoading.set(!1)}})}processCheckout(){return N(this,null,function*(){if(this.cart().length===0)return this.showToast("El carrito est\xE1 vac\xEDo");let e=this.paymentMethod(),t="CASH";e==="YAPE/PLIN"&&(t="YAPE"),e==="TRANSFERENCIA"&&(t="CARD");let i=[{method:t,amount:this.grandTotal()}];return this.processCheckoutWithPayments(i)})}addItem(e){this.cart.update(t=>[...t,e]),this.showToast("Producto Agregado")}updateItem(e){this.cart.update(t=>t.map(i=>i.cartId===e.cartId?e:i)),this.showToast("\xCDtem Actualizado")}removeItem(e){this.cart.update(t=>t.filter(i=>i.cartId!==e))}clearCart(){this.cart.set([]),this.currentCustomer.set(null),this.paymentMethod.set("EFECTIVO")}updateQuantity(e,t){this.cart.update(i=>i.map(o=>{if(o.cartId===e){let s=o.quantity+t;return s<=0?o:s>o.color.stock?(this.showToast(`Stock m\xE1x: ${o.color.stock}`),o):z(V({},o),{quantity:s,total:s*o.unitPrice})}return o}))}openAddModal(e){this.modalState.set({isOpen:!0,product:e,isEditing:!1})}openEditModal(e){this.searchProductBySku(e.sku).then(t=>{t&&this.modalState.set({isOpen:!0,product:t,isEditing:!0,editingCartItem:e})})}closeModal(){this.modalState.set({isOpen:!1,product:null,isEditing:!1})}showToast(e){this.toastMessage.set(e),setTimeout(()=>this.toastMessage.set(null),2500)}setPaymentMethod(e){this.paymentMethod.set(e)}printTicket(e){let i=`${this.apiService.BASE_URL.replace(/\/api\/?$/,"")}/pos/sales/${e}/ticket`,o=document.createElement("iframe");o.style.display="none",o.src=i,document.body.appendChild(o),o.onload=()=>{try{o.contentWindow?.print()}catch(s){console.error(s)}setTimeout(()=>{document.body.removeChild(o)},5e3)}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=se({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function we(n,m){if(n&1){let e=C();r(0,"div",11)(1,"div",12)(2,"div",13),h(3,"i",14),a(),r(4,"div",15)(5,"div",16),c(6),a(),r(7,"div",17),c(8),a()()(),r(9,"button",18),u("click",function(){f(e);let i=p();return g(i.reset())}),h(10,"i",19),a()()}if(n&2){let e,t,i=p();l(6),b(" ",(e=i.posService.currentCustomer())==null?null:e.name," "),l(2),b(" ",(t=i.posService.currentCustomer())==null?null:t.dni," ")}}var he=(()=>{class n{constructor(){this.posService=P(D),this.dniQuery=""}search(){this.posService.searchCustomerByDni(this.dniQuery)||(this.dniQuery="")}reset(){this.posService.currentCustomer.set(null),this.dniQuery=""}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=F({type:n,selectors:[["app-pos-header"]],standalone:!0,features:[A],decls:13,vars:2,consts:[[1,"bg-white","px-3","py-3","shadow-1","z-2","relative","border-bottom-1","border-gray-100","flex-shrink-0"],[1,"flex","justify-content-between","align-items-center","mb-2"],[1,"pi","pi-bars","text-xl","text-gray-500"],[1,"font-bold","text-gray-700"],[1,"w-2rem","h-2rem","border-circle","bg-gray-200","flex","align-items-center","justify-content-center"],[1,"pi","pi-user","text-gray-500"],[1,"relative","w-full"],[1,"pi","pi-user","absolute","text-gray-400","z-1",2,"top","50%","left","1rem","transform","translateY(-50%)"],["type","tel","placeholder","DNI / RUC Cliente","inputmode","numeric",1,"w-full","border-round-xl","py-3","pl-6","pr-6","border-none","bg-gray-100","font-medium","text-gray-800","focus:bg-white","focus:shadow-input","transition-all",3,"ngModelChange","keydown.enter","ngModel"],[1,"absolute","right-0","top-0","h-full","w-3rem","border-none","bg-indigo-600","border-round-right-xl","text-white","cursor-pointer","hover:bg-indigo-700",3,"click"],[1,"pi","pi-search"],[1,"mt-2","bg-indigo-50","border-1","border-indigo-100","border-round-xl","p-2","flex","justify-content-between","align-items-center","slide-down","animation-duration-200"],[1,"flex","align-items-center","gap-2","overflow-hidden"],[1,"bg-indigo-600","text-white","border-circle","w-2rem","h-2rem","flex","align-items-center","justify-content-center","flex-shrink-0"],[1,"pi","pi-check","text-xs"],[1,"overflow-hidden"],[1,"font-bold","text-indigo-900","text-sm","white-space-nowrap","overflow-hidden","text-overflow-ellipsis"],[1,"text-xs","text-indigo-500","font-medium"],[1,"bg-transparent","border-none","text-gray-400","hover:text-gray-600","cursor-pointer","p-2",3,"click"],[1,"pi","pi-times"]],template:function(t,i){t&1&&(r(0,"header",0)(1,"div",1),h(2,"i",2),r(3,"div",3),c(4,"POS"),a(),r(5,"div",4),h(6,"i",5),a()(),r(7,"div",6),h(8,"i",7),r(9,"input",8),Z("ngModelChange",function(s){return J(i.dniQuery,s)||(i.dniQuery=s),s}),u("keydown.enter",function(){return i.search()}),a(),r(10,"button",9),u("click",function(){return i.search()}),h(11,"i",10),a()(),v(12,we,11,2,"div",11),a()),t&2&&(l(9),X("ngModel",i.dniQuery),l(3),y(12,i.posService.currentCustomer()?12:-1))},dependencies:[M,q,j,Q,$],styles:[".shadow-input[_ngcontent-%COMP%]{box-shadow:0 0 0 4px #6366f11a}.slide-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slidedown .3s cubic-bezier(.16,1,.3,1)}@keyframes _ngcontent-%COMP%_slidedown{0%{transform:translateY(-10px);opacity:0}to{transform:translateY(0);opacity:1}}"]})}}return n})();var ke=(n,m)=>m.id;function Pe(n,m){n&1&&(r(0,"div",12),h(1,"i",14),a())}function Me(n,m){if(n&1){let e=C();r(0,"div",13)(1,"div",15)(2,"span",16),c(3,"S/"),a(),r(4,"input",17),u("ngModelChange",function(i){f(e);let o=p().$implicit,s=p();return g(s.updateAmount(o.id,i))}),a()()()}if(n&2){let e=p().$implicit;l(4),O("ngModel",e.amount)}}function Ee(n,m){if(n&1){let e=C();r(0,"div",2)(1,"div",9),u("click",function(){let i=f(e).$implicit,o=p();return g(o.toggleMethod(i.id))}),h(2,"i",10),r(3,"span",11),c(4),a(),v(5,Pe,2,0,"div",12),a(),v(6,Me,5,1,"div",13),a()}if(n&2){let e=m.$implicit,t=p();l(),E("border-indigo-600",e.active&&e.id!=="YAPE")("bg-indigo-50",e.active&&e.id!=="YAPE")("text-indigo-700",e.active&&e.id!=="YAPE")("border-pink-500",e.active&&e.id==="YAPE")("bg-pink-50",e.active&&e.id==="YAPE")("text-pink-600",e.active&&e.id==="YAPE")("border-gray-200",!e.active)("text-gray-500",!e.active)("opacity-60",!e.active),l(),le(e.icon),l(2),k(e.label),l(),y(5,e.active?5:-1),l(),y(6,t.activeMethods().length>1&&e.active?6:-1)}}function Ie(n,m){if(n&1&&(r(0,"div",3)(1,"span",18),c(2),I(3,"number"),a()()),n&2){let e=p();l(2),b(" Falta cubrir: S/ ",T(3,1,e.remaining(),"1.2-2")," ")}}var be=(()=>{class n{constructor(){this.posService=P(D),this.methods=w([{id:"CASH",label:"Efectivo",icon:"pi pi-money-bill",active:!0,amount:null},{id:"YAPE",label:"Yape/Plin",icon:"pi pi-qrcode",active:!1,amount:null},{id:"CARD",label:"Tarjeta",icon:"pi pi-credit-card",active:!1,amount:null}]),this.totalToPay=S(()=>this.posService.grandTotal()),this.activeMethods=S(()=>this.methods().filter(e=>e.active)),this.currentSum=S(()=>this.activeMethods().reduce((e,t)=>e+(t.amount||0),0)),this.remaining=S(()=>this.activeMethods().length<=1?0:Math.max(0,this.totalToPay()-this.currentSum())),ee(()=>{this.posService.cart().length===0&&this.resetMethods()},{allowSignalWrites:!0})}resetMethods(){this.methods.update(e=>e.map(t=>z(V({},t),{active:t.id==="CASH",amount:null})))}toggleMethod(e){this.methods.update(t=>t.map(i=>{if(i.id===e){let o=t.filter(s=>s.active).length;return i.active&&o===1?i:z(V({},i),{active:!i.active,amount:null})}return i}))}updateAmount(e,t){this.methods.update(i=>i.map(o=>o.id===e?z(V({},o),{amount:t}):o))}handleCheckout(){let e=this.activeMethods(),t=this.totalToPay();if(t<=0){this.posService.processCheckoutWithPayments([]);return}let i=[];if(e.length===1)i=[{method:e[0].id,amount:t}];else{if(Math.abs(this.currentSum()-t)>.1){alert(`Los montos no cuadran. Faltan S/ ${this.remaining().toFixed(2)}`);return}i=e.map(o=>({method:o.id,amount:o.amount||0}))}this.posService.processCheckoutWithPayments(i)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=F({type:n,selectors:[["app-pos-footer"]],standalone:!0,features:[A],decls:15,vars:6,consts:[[1,"fixed","bottom-0","left-0","w-full","bg-white","z-4","shadow-top","border-top-1","border-gray-100","px-4","py-3","fadein-animation"],[1,"flex","gap-2","mb-3","align-items-start"],[1,"flex-1","flex","flex-column","gap-2"],[1,"bg-red-50","border-1","border-red-100","border-round-lg","px-3","py-1","mb-2","text-center","fadein-animation"],[1,"flex","justify-content-between","align-items-center","mb-3"],[1,"text-xs","font-bold","text-gray-500","uppercase","letter-spacing-1"],[1,"text-3xl","font-black","text-gray-900"],[1,"w-full","bg-indigo-700","text-white","py-3","border-round-xl","font-bold","text-lg","shadow-3","border-none","cursor-pointer","hover:bg-indigo-800","active:scale-95","transition-all","flex","justify-content-center","align-items-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"pi","pi-check-circle","text-xl"],[1,"border-1","border-round-xl","p-2","cursor-pointer","transition-all","flex","flex-column","align-items-center","justify-content-center","gap-1","h-4rem","relative","overflow-hidden",3,"click"],[1,"text-xl"],[1,"text-xs","font-bold"],[1,"absolute","top-0","right-0","p-1"],[1,"fadein-animation"],[1,"pi","pi-check-circle","text-xs"],[1,"relative","w-full"],[1,"absolute","left-2","translate-y-50","text-gray-400","text-xs","font-bold","position-custom"],["type","number","placeholder","0.00",1,"w-full","border-1","border-gray-300","border-round-lg","py-2","pl-4","pr-1","text-center","font-bold","text-gray-800","text-sm","outline-none","focus:border-indigo-500","transition-colors",3,"ngModelChange","ngModel"],[1,"text-xs","text-red-600","font-bold"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1),R(2,Ee,7,23,"div",2,ke),a(),v(4,Ie,4,4,"div",3),r(5,"div",4)(6,"span",5),c(7,"Total a Pagar"),a(),r(8,"span",6),c(9),I(10,"number"),a()(),r(11,"button",7),u("click",function(){return i.handleCheckout()}),h(12,"i",8),r(13,"span"),c(14,"COBRAR"),a()()()),t&2&&(l(2),B(i.methods()),l(2),y(4,i.activeMethods().length>1&&i.remaining()>.1?4:-1),l(5),b("S/ ",T(10,3,i.posService.grandTotal(),"1.2-2"),""),l(2),O("disabled",i.activeMethods().length>1&&i.remaining()>.1))},dependencies:[M,L,q,j,te,Q,$],styles:[".shadow-top[_ngcontent-%COMP%]{box-shadow:0 -4px 20px #00000014}.fadein-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadein .3s ease-out}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}.position-custom[_ngcontent-%COMP%]{top:30%;padding-left:10px}"]})}}return n})();var Te=(n,m)=>m.color_id;function Ve(n,m){if(n&1){let e=C();r(0,"div",23),u("click",function(){let i=f(e).$implicit,o=p(2);return g(o.selectTabSize(i))}),c(1),a()}if(n&2){let e=m.$implicit,t=p(2);E("border-indigo-600",t.activeSize()===e)("bg-indigo-600",t.activeSize()===e)("text-white",t.activeSize()===e)("border-gray-100",t.activeSize()!==e)("bg-white",t.activeSize()!==e)("text-gray-600",t.activeSize()!==e),l(),b(" ",e," ")}}function ze(n,m){n&1&&(r(0,"div",12),h(1,"i",24),r(2,"span",25),c(3,"Selecciona una talla arriba"),a()())}function Fe(n,m){n&1&&h(0,"i",33)}function Oe(n,m){if(n&1){let e=C();r(0,"div",37),u("click",function(i){return f(e),g(i.stopPropagation())}),r(1,"div",38)(2,"span",39),c(3,"Precio"),a(),r(4,"div",40)(5,"span",41),c(6,"S/"),a(),r(7,"input",42),u("ngModelChange",function(i){f(e);let o=p().$implicit,s=p(3);return g(s.updatePrice(o,i))})("focus",function(i){return f(e),g(i.target.select())}),a()()(),r(8,"div",38)(9,"span",39),c(10,"Cant."),a(),r(11,"div",43)(12,"button",44),u("click",function(i){f(e);let o=p().$implicit,s=p(3);return g(s.updateQty(s.activeSize(),o,-1,i))}),c(13," - "),a(),r(14,"span",45),c(15),a(),r(16,"button",46),u("click",function(i){f(e);let o=p().$implicit,s=p(3);return g(s.updateQty(s.activeSize(),o,1,i))}),c(17," + "),a()()()()}if(n&2){let e=p().$implicit,t=p(3);l(7),O("ngModel",t.getSelectionPrice(e)),l(8),k(t.getSelectionQty(e))}}function Ae(n,m){if(n&1&&(r(0,"div",47)(1,"span",48),c(2),I(3,"number"),a(),r(4,"span",49),c(5,"Toca para agregar"),a()()),n&2){let e=p().$implicit;l(2),b("S/ ",T(3,1,e.price,"1.2-2"),"")}}function je(n,m){if(n&1){let e=C();r(0,"div",30),u("click",function(){let i=f(e).$implicit,o=p(3);return g(i.stock>0&&o.getSelectionQty(i)===0?o.toggleVariant(i):null)}),r(1,"div",31)(2,"div",32),v(3,Fe,1,0,"i",33),a(),r(4,"div",15)(5,"span",34),c(6),a(),r(7,"span",35),c(8),a()()(),v(9,Oe,18,2,"div",36)(10,Ae,6,4),a()}if(n&2){let e=m.$implicit,t=p(3);E("border-indigo-500",t.getSelectionQty(e)>0)("bg-indigo-50",t.getSelectionQty(e)>0)("border-white",t.getSelectionQty(e)===0)("opacity-50",e.stock<=0),l(2),G("background-color",e.hex),E("border-gray-200",e.hex==="#ffffff")("border-transparent",e.hex!=="#ffffff"),l(),y(3,t.getSelectionQty(e)>0?3:-1),l(3),k(e.colorName),l(),E("text-green-600",e.stock>5)("text-red-500",e.stock<=5),l(),b(" Stock: ",e.stock," "),l(),y(9,t.getSelectionQty(e)>0?9:10)}}function Qe(n,m){if(n&1&&(r(0,"div",26)(1,"span",27),c(2),a()(),r(3,"div",28),R(4,je,11,22,"div",29,Te),a()),n&2){let e=p(2);l(2),b("2. Selecciona Variantes (",e.activeSize(),")"),l(2),B(e.currentSizeVariants())}}function $e(n,m){if(n&1){let e=C();r(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),u("click",function(){f(e);let i=p();return g(i.posService.closeModal())}),h(4,"i",4),a(),r(5,"div",5)(6,"h2",6),c(7),a(),r(8,"p",7),c(9),a()(),r(10,"div")(11,"span",8),c(12,"1. Selecciona Talla"),a(),r(13,"div",9),R(14,Ve,2,13,"div",10,ce),a()()(),r(16,"div",11),v(17,ze,4,0,"div",12)(18,Qe,6,1),a(),r(19,"div",13)(20,"div",14)(21,"div",15)(22,"span",16),c(23,"Resumen"),a(),r(24,"span",17)(25,"strong",18),c(26),a(),c(27," prendas "),a()(),r(28,"div",19)(29,"span",16),c(30,"Total Estimado"),a(),r(31,"div",20),c(32),I(33,"number"),a()()(),r(34,"button",21),u("click",function(){f(e);let i=p();return g(i.confirm())}),h(35,"i",22),r(36,"span"),c(37),a()()()()()}if(n&2){let e,t,i=p();l(7),b(" ",(e=i.posService.modalState().product)==null?null:e.name," "),l(2),b(" SKU: ",(t=i.posService.modalState().product)==null?null:t.sku," "),l(5),B(i.availableSizes()),l(3),y(17,i.activeSize()?18:17),l(9),k(i.totalModalItems()),l(6),b(" S/ ",T(33,7,i.totalModalPrice(),"1.2-2")," "),l(2),O("disabled",i.totalModalItems()===0),l(3),k(i.posService.modalState().isEditing?"GUARDAR CAMBIOS":"AGREGAR AL CARRITO")}}var ve=(()=>{class n{constructor(){this.posService=P(D),this.activeSize=w(null),this.selections=w(new Map),this.availableSizes=S(()=>{let e=this.posService.modalState().product;return e?Object.keys(e.variants):[]}),this.currentSizeVariants=S(()=>{let e=this.posService.modalState().product,t=this.activeSize();return!e||!t?[]:e.variants[t]||[]}),this.totalModalItems=S(()=>{let e=0;for(let t of this.selections().values())e+=t.qty;return e}),this.totalModalPrice=S(()=>{let e=0;for(let t of this.selections().values())e+=t.qty*t.price;return e}),ee(()=>{let e=this.posService.modalState();fe(()=>{if(e.isOpen&&e.product){let t=new Map;if(this.activeSize.set(null),this.posService.cart().filter(s=>s.productId===e.product.id).forEach(s=>{let _=(e.product.variants[s.size]||[]).find(x=>String(x.color_id)===String(s.color.color_id));if(_){let x=this.getItemKey(s.size,_.color_id);t.set(x,{variant:_,size:s.size,qty:s.quantity,price:s.unitPrice})}}),this.selections.set(t),e.isEditing&&e.editingCartItem)this.activeSize.set(e.editingCartItem.size);else{let s=e.product.sku,d=null,_=null;for(let x in e.product.variants){let oe=e.product.variants[x].find(Se=>Se.sku===s);if(oe){d=x,_=oe;break}}if(d&&_){this.activeSize.set(d);let x=this.getItemKey(d,_.color_id);if(t.has(x)){let W=t.get(x);W.qty<_.stock&&(W.qty++,t.set(x,W),this.selections.set(new Map(t)))}else this.addSelection(d,_,1,_.price)}else{let x=Object.keys(e.product.variants);x.length>0&&this.activeSize.set(x[0])}}}})},{allowSignalWrites:!0})}getItemKey(e,t){return`${e}_${String(t)}`}selectTabSize(e){this.activeSize.set(e)}toggleVariant(e){let t=this.activeSize();if(!t||e.stock<=0)return;let i=this.getItemKey(t,e.color_id),o=new Map(this.selections());if(o.has(i)){let s=o.get(i);s.qty<e.stock&&(s.qty++,o.set(i,s))}else o.set(i,{variant:e,size:t,qty:1,price:e.price});this.selections.set(o)}addSelection(e,t,i,o){let s=this.getItemKey(e,t.color_id),d=new Map(this.selections());d.set(s,{variant:t,size:e,qty:i,price:o}),this.selections.set(d)}updateQty(e,t,i,o){o&&o.stopPropagation();let s=this.getItemKey(e,t.color_id),d=new Map(this.selections());if(!d.has(s)){i>0&&this.toggleVariant(t);return}let _=d.get(s),x=_.qty+i;x<=0?d.delete(s):x<=t.stock&&(_.qty=x,d.set(s,_)),this.selections.set(d)}updatePrice(e,t){let i=this.activeSize();if(!i)return;let o=this.getItemKey(i,e.color_id),s=new Map(this.selections());if(s.has(o)){let d=s.get(o);d.price=t,s.set(o,d),this.selections.set(s)}}getSelectionQty(e){let t=this.activeSize();if(!t)return 0;let i=this.getItemKey(t,e.color_id);return this.selections().get(i)?.qty||0}getSelectionPrice(e){let t=this.activeSize();if(!t)return e.price;let i=this.getItemKey(t,e.color_id);return this.selections().get(i)?.price||e.price}confirm(){let e=this.posService.modalState();if(!e.product)return;let t=this.selections(),o=this.posService.cart().filter(d=>d.productId===e.product.id),s=new Set;for(let d of t.values()){let _=o.find(x=>x.size===d.size&&String(x.color.color_id)===String(d.variant.color_id));if(_){let x=z(V({},_),{quantity:d.qty,unitPrice:d.price,total:d.qty*d.price,color:d.variant});this.posService.updateItem(x),s.add(_.cartId)}else{let x={cartId:Date.now()+Math.random(),productId:e.product.id,sku:e.product.sku,name:e.product.name,size:d.size,color:d.variant,quantity:d.qty,unitPrice:d.price,total:d.qty*d.price};this.posService.addItem(x)}}for(let d of o)s.has(d.cartId)||this.posService.removeItem(d.cartId);this.posService.closeModal()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=F({type:n,selectors:[["app-pos-selector"]],standalone:!0,features:[A],decls:1,vars:1,consts:[[1,"fixed","top-0","left-0","w-full","h-full","z-6","flex","align-items-end","sm:align-items-center","justify-content-center","glass-overlay","fadein-animation"],[1,"bg-white","w-full","sm:w-30rem","border-round-top-2xl","sm:border-round-2xl","p-0","shadow-6","slide-up","max-h-screen","overflow-hidden","relative","flex","flex-column","h-[85vh]","sm:h-auto"],[1,"p-4","pb-2","bg-white","z-20","border-bottom-1","border-gray-100","relative"],[1,"absolute","top-0","right-0","m-4","bg-transparent","border-none","text-gray-400","hover:text-gray-600","cursor-pointer","p-2","z-30",3,"click"],[1,"pi","pi-times","text-xl"],[1,"pr-5","mb-3"],[1,"text-xl","font-bold","text-gray-900","m-0","line-height-2"],[1,"text-gray-500","text-sm","font-mono","m-0","mt-1"],[1,"text-xs","font-bold","text-gray-400","uppercase","block","mb-2"],[1,"flex","gap-2","overflow-x-auto","pb-2","scrollbar-hide"],[1,"px-4","py-3","border-1","border-round-xl","cursor-pointer","transition-all","font-bold","text-sm","min-w-3rem","text-center","select-none","shadow-1","flex-shrink-0","relative",3,"border-indigo-600","bg-indigo-600","text-white","border-gray-100","bg-white","text-gray-600"],[1,"flex-1","overflow-y-auto","p-4","bg-gray-50"],[1,"flex","flex-column","align-items-center","justify-content-center","h-full","text-gray-400","opacity-60"],[1,"p-4","border-top-1","border-gray-200","bg-white","z-20","shadow-up-2"],[1,"flex","justify-content-between","align-items-center","mb-3"],[1,"flex","flex-column"],[1,"text-xs","font-bold","text-gray-500","uppercase"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-indigo-600","text-lg"],[1,"text-right"],[1,"font-black","text-xl","text-gray-900"],[1,"w-full","font-bold","py-3","bg-gray-900","text-white","border-round-xl","shadow-3","border-none","cursor-pointer","hover:bg-black","transition-all","disabled:opacity-50","text-lg","flex","align-items-center","justify-content-center","gap-2",3,"click","disabled"],[1,"pi","pi-check"],[1,"px-4","py-3","border-1","border-round-xl","cursor-pointer","transition-all","font-bold","text-sm","min-w-3rem","text-center","select-none","shadow-1","flex-shrink-0","relative",3,"click"],[1,"pi","pi-arrow-up","text-4xl","mb-2"],[1,"font-bold","text-sm"],[1,"flex","justify-content-between","mb-2","px-1"],[1,"text-xs","font-bold","text-gray-400","uppercase"],[1,"flex","flex-column","gap-3"],[1,"bg-white","p-3","border-round-2xl","shadow-1","flex","flex-column","sm:flex-row","sm:align-items-center","gap-3","transition-all","border-1",3,"border-indigo-500","bg-indigo-50","border-white","opacity-50"],[1,"bg-white","p-3","border-round-2xl","shadow-1","flex","flex-column","sm:flex-row","sm:align-items-center","gap-3","transition-all","border-1",3,"click"],[1,"flex","align-items-center","gap-3","flex-1"],[1,"w-3rem","h-3rem","border-circle","border-1","shadow-1","relative","flex","align-items-center","justify-content-center","flex-shrink-0"],[1,"pi","pi-check","text-white","text-xl","shadow-2","border-circle","p-1","bg-black-alpha-20"],[1,"font-bold","text-gray-800","text-sm","capitalize"],[1,"text-xs"],[1,"flex","align-items-center","gap-3","justify-content-between","sm:justify-content-end","w-full","sm:w-auto","mt-2","sm:mt-0","pt-2","sm:pt-0","border-top-1","sm:border-top-none","border-gray-200","sm:border-none"],[1,"flex","align-items-center","gap-3","justify-content-between","sm:justify-content-end","w-full","sm:w-auto","mt-2","sm:mt-0","pt-2","sm:pt-0","border-top-1","sm:border-top-none","border-gray-200","sm:border-none",3,"click"],[1,"flex","flex-column","align-items-center"],[1,"text-xs","text-gray-500","font-bold","uppercase","mb-1"],[1,"relative","w-5rem"],[1,"absolute","left-0","top-custom","translate-y-50","ml-2","text-gray-500","text-xs","font-bold"],["type","number",1,"w-full","border-1","border-gray-200","border-round-lg","py-2","pl-4","pr-1","text-right","font-bold","text-indigo-700","bg-white","focus:border-indigo-500","outline-none","text-sm","h-custom","shadow-1",3,"ngModelChange","focus","ngModel"],[1,"flex","align-items-center","bg-white","border-round-lg","shadow-1","h-2.2rem","border-1","border-gray-200"],[1,"border-none","bg-transparent","w-2rem","h-full","text-indigo-600","font-bold","hover:bg-gray-100","border-round-left-lg","cursor-pointer","text-lg",3,"click"],[1,"font-bold","text-base","w-1.5rem","text-center","text-gray-900"],[1,"border-none","bg-transparent","w-2rem","h-full","text-indigo-600","font-bold","hover:bg-gray-100","border-round-right-lg","cursor-pointer","text-lg",3,"click"],[1,"text-right","hidden","sm:block"],[1,"font-bold","text-gray-400","text-sm","block"],[1,"text-xs","text-indigo-500","font-bold"]],template:function(t,i){t&1&&v(0,$e,38,10,"div",0),t&2&&y(0,i.posService.modalState().isOpen?0:-1)},dependencies:[M,L,q,j,te,Q,$],styles:[".glass-overlay[_ngcontent-%COMP%]{background:#0009;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.fadein-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadein .2s ease-out}.slide-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideup .3s cubic-bezier(.16,1,.3,1)}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideup{0%{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.h-custom[_ngcontent-%COMP%]{height:22px}.top-custom[_ngcontent-%COMP%]{top:20%}"]})}}return n})();var qe=["barcodeInput"],De=(n,m)=>m.cartId;function Ne(n,m){if(n&1&&(r(0,"div",3),h(1,"i",15),r(2,"span",16),c(3),a()()),n&2){let e=p();l(3),k(e.posService.toastMessage())}}function Re(n,m){if(n&1){let e=C();r(0,"span",17),u("click",function(){f(e);let i=p();return g(i.posService.clearCart())}),c(1,"Vaciar"),a()}}function Be(n,m){n&1&&(r(0,"div",12),h(1,"i",18),r(2,"span",19),c(3,"Empieza a escanear"),a()())}function Le(n,m){if(n&1){let e=C();r(0,"div",21),h(1,"div",22),r(2,"div",23)(3,"div",24)(4,"span",25),c(5),a(),r(6,"i",26),u("click",function(){let i=f(e).$implicit,o=p(2);return g(o.posService.removeItem(i.cartId))}),a()(),r(7,"div",27)(8,"div",28),u("click",function(){let i=f(e).$implicit,o=p(2);return g(o.posService.openEditModal(i))}),r(9,"span",29),c(10),a(),h(11,"i",30),a(),r(12,"span",31),u("click",function(){let i=f(e).$implicit,o=p(2);return g(o.posService.openEditModal(i))}),c(13),I(14,"number"),a()(),r(15,"div",32)(16,"div",33)(17,"button",34),u("click",function(){let i=f(e).$implicit,o=p(2);return g(o.posService.updateQuantity(i.cartId,-1))}),c(18," - "),a(),r(19,"span",35),c(20),a(),r(21,"button",36),u("click",function(){let i=f(e).$implicit,o=p(2);return g(o.posService.updateQuantity(i.cartId,1))}),c(22," + "),a()(),r(23,"span",37),c(24),I(25,"number"),a()()()()}if(n&2){let e=m.$implicit;l(),G("background-color",e.color.hex),E("border-1",e.color.hex==="#ffffff")("border-gray-200",e.color.hex==="#ffffff"),l(4),k(e.name),l(5),ue("",e.size," \u2022 ",e.color.colorName,""),l(3),b(" S/ ",T(14,12,e.unitPrice,"1.2-2")," "),l(7),k(e.quantity),l(4),b("Total: S/ ",T(25,15,e.total,"1.2-2"),"")}}function Ye(n,m){if(n&1&&(r(0,"div",20),R(1,Le,26,18,"div",21,De),a()),n&2){let e=p();l(),B(e.posService.cart())}}var ye=(()=>{class n{constructor(){this.posService=P(D),this.barcodeQuery="",this.barcodeSubject=new re}ngOnInit(){this.barcodeSubscription=this.barcodeSubject.pipe(ae(300)).subscribe(e=>{e&&this.onScan()})}onScan(){return N(this,null,function*(){let e=this.barcodeQuery.trim();if(!e)return;let t=yield this.posService.searchProductBySku(e);t?(this.posService.openAddModal(t),this.barcodeQuery=""):this.barcodeQuery=""})}onQueryChange(e){this.barcodeSubject.next(e)}ngAfterViewChecked(){!this.posService.modalState().isOpen&&this.barcodeInput}ngOnDestroy(){this.barcodeSubscription&&this.barcodeSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=F({type:n,selectors:[["app-pos"]],viewQuery:function(t,i){if(t&1&&de(qe,5),t&2){let o;pe(o=me())&&(i.barcodeInput=o.first)}},standalone:!0,features:[A],decls:18,vars:5,consts:[["mainScroll",""],["barcodeInput",""],[1,"flex","flex-column","h-screen","bg-ground","font-family","overflow-hidden","relative","bg-white","rounded-xl"],[1,"fixed","top-0","left-50","border-round-2xl","mt-4","px-4","py-3","shadow-6","z-5","bg-gray-900","text-white","flex","align-items-center","gap-2","fadein-animation",2,"transform","translateX(-50%)"],[1,"flex-1","overflow-y-auto","p-3","pb-8",2,"padding-bottom","140px !important"],[1,"mb-4","bg-white","border-round-xl","shadow-1","overflow-hidden","flex","align-items-center","border-1","border-gray-100"],["type","text","placeholder","Escanear c\xF3digo...","autofocus","",1,"flex-1","py-3","px-3","text-lg","font-mono","border-none","outline-none","text-gray-800","placeholder-gray-400",3,"ngModelChange","ngModel"],[1,"bg-gray-100","text-gray-600","border-none","px-4","py-3","cursor-pointer","hover:bg-gray-200","border-left-1","border-gray-200",3,"click"],[1,"pi","pi-barcode","text-xl"],[1,"flex","justify-content-between","align-items-end","mb-3","px-1","border-bottom-1","border-gray-200","pb-2"],[1,"text-xs","font-bold","text-gray-500","uppercase","tracking-widest"],["class","text-xs font-bold text-red-500 cursor-pointer hover:text-red-700 uppercase",3,"click",4,"ngIf"],[1,"flex","flex-column","align-items-center","justify-content-center","py-8","opacity-40","text-gray-400"],[1,"z-2"],[1,"z-3"],[1,"pi","pi-info-circle","text-lg"],[1,"font-bold","text-sm"],[1,"text-xs","font-bold","text-red-500","cursor-pointer","hover:text-red-700","uppercase",3,"click"],[1,"pi","pi-shopping-bag","text-6xl","mb-3","text-gray-300"],[1,"text-sm","font-medium"],[1,"flex","flex-column","gap-3"],[1,"bg-white","p-3","border-round-2xl","shadow-1","flex","gap-3","relative","overflow-hidden","fadein-animation","border-1","border-gray-50","item-card"],[1,"w-3rem","h-3rem","border-circle","shadow-1","flex-shrink-0","mt-1"],[1,"flex-1","min-w-0"],[1,"flex","justify-content-between","align-items-start","mb-1"],[1,"font-bold","text-gray-900","text-sm","line-height-2","block","pr-2"],[1,"pi","pi-trash","text-red-300","hover:text-red-500","cursor-pointer","p-1",3,"click"],[1,"flex","align-items-center","flex-wrap","gap-2"],[1,"bg-gray-50","border-1","border-gray-200","border-round-lg","px-2","py-1","flex","align-items-center","gap-1","cursor-pointer","hover:bg-gray-100","transition-colors",3,"click"],[1,"text-xs","font-bold","text-gray-600","uppercase"],[1,"pi","pi-pencil","text-xs","text-indigo-400","ml-1"],[1,"ml-auto","font-bold","text-indigo-600","text-sm","cursor-pointer","border-bottom-1","border-indigo-300",3,"click"],[1,"flex","justify-content-between","align-items-center","mt-3","pt-2","border-top-1","border-gray-100"],[1,"flex","align-items-center","bg-gray-50","border-round-lg","border-1","border-gray-200","h-2rem","shadow-none"],[1,"border-none","bg-transparent","px-3","h-full","text-gray-500","font-bold","hover:bg-gray-200","border-round-left-lg","cursor-pointer",3,"click"],[1,"font-bold","text-sm","w-2rem","text-center"],[1,"border-none","bg-transparent","px-3","h-full","text-indigo-600","font-bold","hover:bg-indigo-50","border-round-right-lg","cursor-pointer",3,"click"],[1,"font-bold","text-sm","text-gray-800"]],template:function(t,i){if(t&1){let o=C();r(0,"div",2),v(1,Ne,4,1,"div",3),h(2,"app-pos-header"),r(3,"main",4,0)(5,"div",5)(6,"input",6,1),Z("ngModelChange",function(d){return f(o),J(i.barcodeQuery,d)||(i.barcodeQuery=d),g(d)}),u("ngModelChange",function(d){return f(o),g(i.onQueryChange(d))}),a(),r(8,"button",7),u("click",function(){return f(o),g(i.onScan())}),h(9,"i",8),a()(),r(10,"div",9)(11,"span",10),c(12),a(),v(13,Re,2,0,"span",11),a(),v(14,Be,4,0,"div",12)(15,Ye,3,0),a(),h(16,"app-pos-footer",13)(17,"app-pos-selector",14),a()}t&2&&(l(),y(1,i.posService.toastMessage()?1:-1),l(5),X("ngModel",i.barcodeQuery),l(6),b("Carrito (",i.posService.totalItems(),")"),l(),O("ngIf",i.posService.cart().length>0),l(),y(14,i.posService.cart().length===0?14:15))},dependencies:[M,ge,L,q,j,Q,$,he,be,ve],styles:[".fadein-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadein .3s ease-out}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}.item-card[_ngcontent-%COMP%]{transition:transform .1s}.item-card[_ngcontent-%COMP%]:active{transform:scale(.98)}main[_ngcontent-%COMP%]::-webkit-scrollbar{width:0px;background:transparent}"]})}}return n})();var We=[{path:"",component:ye},{path:"",pathMatch:"full",redirectTo:"sales/pos"}],Ce=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=U({type:n})}static{this.\u0275inj=H({imports:[ie.forChild(We),ie]})}}return n})();var jt=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=U({type:n})}static{this.\u0275inj=H({imports:[M,Ce]})}}return n})();export{jt as PosModule};
